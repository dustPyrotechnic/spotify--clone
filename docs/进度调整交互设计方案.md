# è¿›åº¦è°ƒæ•´äº¤äº’è®¾è®¡æ–¹æ¡ˆ

> è¯´æ˜ï¼šè¯†åˆ«ç”¨æˆ·è¿›åº¦è°ƒæ•´æ“ä½œï¼Œå®ç°"æš‚åœ-è°ƒæ•´-æ¢å¤"çš„å®Œæ•´æµç¨‹

---

## ä¸€ã€éœ€æ±‚åˆ†æ

### 1.1 åœºæ™¯æè¿°

ç”¨æˆ·åœ¨æ’­æ”¾æ­Œæ›²æ—¶ï¼Œå¯èƒ½éœ€è¦è·³è½¬åˆ°ç‰¹å®šæ—¶é—´ç‚¹ï¼ˆå¦‚å‰¯æ­Œéƒ¨åˆ†ï¼‰ã€‚ç†æƒ³äº¤äº’ï¼š
1. ç”¨æˆ·æ‹–åŠ¨è¿›åº¦æ¡ï¼ˆæˆ–åœ¨é”å±æ‹–åŠ¨è¿›åº¦ï¼‰
2. éŸ³ä¹è‡ªåŠ¨æš‚åœ
3. ç”¨æˆ·æ¾å¼€æ‰‹æŒ‡ï¼Œç¡®å®šæ–°ä½ç½®
4. éŸ³ä¹ä»è¯¥ä½ç½®ç»§ç»­æ’­æ”¾

### 1.2 æ¶‰åŠä¸¤ä¸ªå…¥å£

| å…¥å£ | ç»„ä»¶ | äº‹ä»¶ç±»å‹ |
|------|------|----------|
| **App å†…** | UISlider (`mainSlider`) | TouchDown / ValueChanged / TouchUpInside |
| **é”å±** | MPRemoteCommandCenter | MPChangePlaybackPositionCommand |

---

## äºŒã€æ ¸å¿ƒè®¾è®¡æ€è·¯

### 2.1 çŠ¶æ€æœºè®¾è®¡

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   æ­£å¸¸æ’­æ”¾çŠ¶æ€   â”‚
                    â”‚   (å®šæ—¶å™¨è¿è¡Œ)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                â”‚                â”‚
            â–¼                â–¼                â–¼
    ç”¨æˆ·è§¦æ‘¸æ»‘å—      é”å±æ‹–åŠ¨è¿›åº¦      å…¶ä»–æ“ä½œ
            â”‚                â”‚                â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   è¿›åº¦è°ƒæ•´çŠ¶æ€   â”‚
                    â”‚   (å®šæ—¶å™¨æš‚åœ)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                â”‚                â”‚
            â–¼                â–¼                â–¼
    ç”¨æˆ·æ¾å¼€æ‰‹æŒ‡      é”å±ç¡®è®¤ä½ç½®      å–æ¶ˆæ“ä½œ
            â”‚                â”‚                â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   è·³è½¬åˆ°æ–°ä½ç½®   â”‚
                    â”‚   æ¢å¤æ’­æ”¾      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 å…³é”®è®¾è®¡è¦ç‚¹

1. **TouchDown æ—¶æš‚åœ**ï¼šç”¨æˆ·æ‰‹æŒ‡è§¦ç¢°æ»‘å—å°±ç«‹å³æš‚åœï¼Œä¸ç­‰å¾…æ¾å¼€
2. **æ‹–åŠ¨æ—¶æ›´æ–°æ˜¾ç¤º**ï¼šå®æ—¶æ˜¾ç¤ºç›®æ ‡æ—¶é—´ç‚¹ï¼Œä½†ä¸å®é™…è·³è½¬
3. **TouchUp æ—¶è·³è½¬**ï¼šæ¾å¼€æ‰‹æŒ‡æ‰æ‰§è¡ŒçœŸæ­£çš„ seek æ“ä½œ
4. **é”å±å’Œ UI ç»Ÿä¸€**ï¼šä¸¤å¥—æ¥å£å…±ç”¨åŒä¸€å¥—é€»è¾‘

---

## ä¸‰ã€UI è¿›åº¦æ¡å®ç°æ–¹æ¡ˆ

### 3.1 UISlider äº‹ä»¶è¯´æ˜

| äº‹ä»¶ | è§¦å‘æ—¶æœº | ç”¨é€” |
|------|----------|------|
| `UIControlEventTouchDown` | æ‰‹æŒ‡è§¦ç¢°æ»‘å— | **æš‚åœéŸ³ä¹**ï¼Œå¼€å§‹è°ƒæ•´ |
| `UIControlEventValueChanged` | æ»‘å—å€¼å˜åŒ– | æ›´æ–°æ—¶é—´æ˜¾ç¤ºï¼ˆä¸è·³è½¬ï¼‰ |
| `UIControlEventTouchUpInside` | æ‰‹æŒ‡åœ¨æ»‘å—å†…æ¾å¼€ | **æ‰§è¡Œè·³è½¬**ï¼Œæ¢å¤æ’­æ”¾ |
| `UIControlEventTouchUpOutside` | æ‰‹æŒ‡åœ¨æ»‘å—å¤–æ¾å¼€ | **æ‰§è¡Œè·³è½¬**ï¼Œæ¢å¤æ’­æ”¾ |
| `UIControlEventTouchCancel` | æ‰‹åŠ¿è¢«å–æ¶ˆ | **æ‰§è¡Œè·³è½¬**ï¼Œæ¢å¤æ’­æ”¾ |

### 3.2 ä»£ç å®ç°æ­¥éª¤

**æ­¥éª¤ 1ï¼šæ·»åŠ äº‹ä»¶ç›‘å¬ï¼ˆXCMusicPlayerViewController.mï¼‰**

```objc
- (void)viewDidLoad {
    // ... åŸæœ‰ä»£ç  ...
    
    // æ·»åŠ æ»‘å—äº‹ä»¶ç›‘å¬
    [self.mainView.mainSlider addTarget:self 
                                 action:@selector(sliderTouchDown:) 
                       forControlEvents:UIControlEventTouchDown];
    
    [self.mainView.mainSlider addTarget:self 
                                 action:@selector(sliderValueChanged:) 
                       forControlEvents:UIControlEventValueChanged];
    
    [self.mainView.mainSlider addTarget:self 
                                 action:@selector(sliderTouchUp:) 
                       forControlEvents:UIControlEventTouchUpInside | UIControlEventTouchUpOutside];
}
```

**æ­¥éª¤ 2ï¼šå¤„ç† TouchDown - æš‚åœå¹¶è®°å½•çŠ¶æ€**

```objc
@interface XCMusicPlayerViewController ()
@property (nonatomic, assign) BOOL wasPlayingBeforeSeek;  // è®°å½•è°ƒæ•´å‰æ˜¯å¦åœ¨æ’­æ”¾
@property (nonatomic, assign) BOOL isSeeking;             // æ˜¯å¦æ­£åœ¨è°ƒæ•´è¿›åº¦
@end

- (void)sliderTouchDown:(UISlider *)slider {
    NSLog(@"[PlayerVC] ğŸ‘‡ ç”¨æˆ·å¼€å§‹æ‹–åŠ¨è¿›åº¦æ¡");
    
    // 1. è®°å½•å½“å‰æ’­æ”¾çŠ¶æ€
    self.isSeeking = YES;
    self.wasPlayingBeforeSeek = self.musicPlayerModel.player.rate > 0;
    
    // 2. å¦‚æœæ­£åœ¨æ’­æ”¾ï¼Œæš‚åœ
    if (self.wasPlayingBeforeSeek) {
        [self.musicPlayerModel pauseMusic];
    }
    
    // 3. åœæ­¢å®šæ—¶å™¨ï¼ˆé˜²æ­¢é”å±è¿›åº¦ç»§ç»­æ›´æ–°ï¼‰
    [self.musicPlayerModel stopLockScreenProgressTimer];
}
```

**æ­¥éª¤ 3ï¼šå¤„ç† ValueChanged - æ›´æ–°æ˜¾ç¤º**

```objc
- (void)sliderValueChanged:(UISlider *)slider {
    // 1. å°† slider çš„ 0.0~1.0 è½¬æ¢ä¸ºå®é™…æ—¶é—´ï¼ˆç§’ï¼‰
    CGFloat progress = slider.value;  // 0.0 ~ 1.0
    NSTimeInterval totalDuration = self.musicPlayerModel.nowPlayingSong.duration / 1000.0;
    NSTimeInterval targetTime = progress * totalDuration;
    
    // 2. æ›´æ–°æ—¶é—´æ˜¾ç¤ºï¼ˆä¸å®é™…è·³è½¬ï¼‰
    NSString *timeText = [self formatTime:targetTime];
    NSLog(@"[PlayerVC] ğŸšï¸ æ‹–åŠ¨ä¸­: %@", timeText);
    
    // 3. å¯é€‰ï¼šæ›´æ–°å½“å‰æ—¶é—´æ ‡ç­¾æ˜¾ç¤º
    // self.mainView.currentTimeLabel.text = timeText;
    
    // 4. æ›´æ–°é”å±æ˜¾ç¤ºï¼ˆè®©é”å±ä¹Ÿçœ‹åˆ°é¢„è§ˆæ—¶é—´ï¼‰
    [self updateLockScreenPreviewTime:targetTime];
}

// è¾…åŠ©æ–¹æ³•ï¼šæ ¼å¼åŒ–æ—¶é—´
- (NSString *)formatTime:(NSTimeInterval)timeInterval {
    NSInteger minutes = (NSInteger)timeInterval / 60;
    NSInteger seconds = (NSInteger)timeInterval % 60;
    return [NSString stringWithFormat:@"%02ld:%02ld", (long)minutes, (long)seconds];
}
```

**æ­¥éª¤ 4ï¼šå¤„ç† TouchUp - æ‰§è¡Œè·³è½¬å¹¶æ¢å¤**

```objc
- (void)sliderTouchUp:(UISlider *)slider {
    NSLog(@"[PlayerVC] ğŸ‘† ç”¨æˆ·æ¾å¼€è¿›åº¦æ¡");
    
    // 1. è®¡ç®—ç›®æ ‡æ—¶é—´
    CGFloat progress = slider.value;
    NSTimeInterval totalDuration = self.musicPlayerModel.nowPlayingSong.duration / 1000.0;
    NSTimeInterval targetTime = progress * totalDuration;
    
    // 2. æ‰§è¡Œè·³è½¬ï¼ˆseekï¼‰
    [self seekToTime:targetTime];
    
    // 3. å¦‚æœä¹‹å‰åœ¨æ’­æ”¾ï¼Œæ¢å¤æ’­æ”¾
    if (self.wasPlayingBeforeSeek) {
        [self.musicPlayerModel playMusic];
    }
    
    // 4. é‡ç½®çŠ¶æ€
    self.isSeeking = NO;
}

// è·³è½¬åˆ°æŒ‡å®šæ—¶é—´
- (void)seekToTime:(NSTimeInterval)time {
    CMTime targetCMTime = CMTimeMakeWithSeconds(time, NSEC_PER_SEC);
    
    [self.musicPlayerModel.player seekToTime:targetCMTime 
                           completionHandler:^(BOOL finished) {
        if (finished) {
            NSLog(@"[PlayerVC] âœ… è·³è½¬å®Œæˆ: %.1fs", time);
            // è·³è½¬å®Œæˆåæ›´æ–°é”å±ä¿¡æ¯
            [self.musicPlayerModel updateLockScreenInfo];
        } else {
            NSLog(@"[PlayerVC] âš ï¸ è·³è½¬è¢«å–æ¶ˆ");
        }
    }];
}

// æ›´æ–°é”å±é¢„è§ˆæ—¶é—´ï¼ˆæ‹–åŠ¨æ—¶å®æ—¶æ˜¾ç¤ºï¼‰
- (void)updateLockScreenPreviewTime:(NSTimeInterval)time {
    MPNowPlayingInfoCenter *infoCenter = [MPNowPlayingInfoCenter defaultCenter];
    NSMutableDictionary *dict = [NSMutableDictionary dictionaryWithDictionary:infoCenter.nowPlayingInfo];
    
    // åªæ›´æ–°å·²æ’­æ”¾æ—¶é—´ï¼Œå…¶ä»–ä¿¡æ¯ä¸å˜
    [dict setObject:@(time) forKey:MPNowPlayingInfoPropertyElapsedPlaybackTime];
    // Rate è®¾ä¸º 0ï¼Œè¡¨ç¤ºæš‚åœçŠ¶æ€
    [dict setObject:@(0.0) forKey:MPNowPlayingInfoPropertyPlaybackRate];
    
    [infoCenter setNowPlayingInfo:dict];
}
```

---

## å››ã€é”å±è¿›åº¦æ§åˆ¶å®ç°

### 4.1 ä¿®æ”¹ç°æœ‰ä»£ç 

å½“å‰ä»£ç åœ¨ `setupRemoteCommands` ä¸­åªæ˜¯æ‰“å°æ—¥å¿—ï¼š

```objc
[commandCenter.changePlaybackPositionCommand addTargetWithHandler:^MPRemoteCommandHandlerStatus(MPRemoteCommandEvent * _Nonnull event) {
    MPChangePlaybackPositionCommandEvent *positionEvent = (MPChangePlaybackPositionCommandEvent *)event;
    NSLog(@"[PlayerModel] ğŸ›ï¸ è¿œç¨‹å‘½ä»¤: è¿›åº¦è°ƒæ•´ -> %.1fs", positionEvent.positionTime);
    // TODO: è‡ªå·±çš„è°ƒæ•´æ’­æ”¾æ—¶é—´çš„æ“ä½œ
    return MPRemoteCommandHandlerStatusSuccess;
}];
```

### 4.2 å®Œæ•´å®ç°

```objc
[commandCenter.changePlaybackPositionCommand addTargetWithHandler:^MPRemoteCommandHandlerStatus(MPRemoteCommandEvent * _Nonnull event) {
    MPChangePlaybackPositionCommandEvent *positionEvent = (MPChangePlaybackPositionCommandEvent *)event;
    NSTimeInterval targetTime = positionEvent.positionTime;
    
    NSLog(@"[PlayerModel] ğŸ›ï¸ é”å±è¿›åº¦è°ƒæ•´: %.1fs", targetTime);
    
    // 1. è®°å½•æ˜¯å¦åœ¨æ’­æ”¾
    BOOL wasPlaying = self.player.rate > 0;
    
    // 2. æš‚åœ
    if (wasPlaying) {
        [self pauseMusic];
    }
    
    // 3. æ‰§è¡Œè·³è½¬
    CMTime targetCMTime = CMTimeMakeWithSeconds(targetTime, NSEC_PER_SEC);
    __weak typeof(self) weakSelf = self;
    [self.player seekToTime:targetCMTime completionHandler:^(BOOL finished) {
        if (finished) {
            NSLog(@"[PlayerModel] âœ… é”å±è·³è½¬å®Œæˆ");
            
            // 4. å¦‚æœä¹‹å‰åœ¨æ’­æ”¾ï¼Œæ¢å¤æ’­æ”¾
            if (wasPlaying) {
                [weakSelf playMusic];
            }
        }
    }];
    
    return MPRemoteCommandHandlerStatusSuccess;
}];
```

---

## äº”ã€å®Œæ•´æµç¨‹ç¤ºä¾‹

### 5.1 App å†…æ‹–åŠ¨åœºæ™¯

```
æ—¶é—´è½´ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º

æ’­æ”¾ä¸­...ï¼ˆå®šæ—¶å™¨æ¯ç§’æ›´æ–°é”å±ï¼‰
    â”‚
    â–¼
ç”¨æˆ·è§¦æ‘¸æ»‘å— â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º ç”¨æˆ·æ¾å¼€æ»‘å—
    â”‚                                      â”‚
    â–¼                                      â–¼
TouchDown è§¦å‘:                     TouchUp è§¦å‘:
â”œâ”€â”€ è®°å½• wasPlaying = YES           â”œâ”€â”€ è®¡ç®—ç›®æ ‡æ—¶é—´ 01:23
â”œâ”€â”€ è°ƒç”¨ pauseMusic()               â”œâ”€â”€ seekToTime(83ç§’)
â”œâ”€â”€ åœæ­¢å®šæ—¶å™¨                      â””â”€â”€ æ¢å¤ playMusic()
â”‚                                       
â””â”€â”€ isSeeking = YES                       
    â”‚
    â–¼
æ‹–åŠ¨ä¸­...ï¼ˆValueChanged æ¯ç§’å¤šæ¬¡ï¼‰
â”œâ”€â”€ è®¡ç®—é¢„è§ˆæ—¶é—´
â”œâ”€â”€ æ›´æ–° UI æ—¶é—´æ˜¾ç¤º
â””â”€â”€ æ›´æ–°é”å±é¢„è§ˆæ—¶é—´

é”å±æ˜¾ç¤ºå˜åŒ–:
00:12 â–¶ï¸ å‘¨æ·± - èœƒæ¥¼
  â”‚
  â”œâ”€â”€ TouchDown å:
  â”‚   00:12 â¸ï¸ å‘¨æ·± - èœƒæ¥¼  (æš‚åœçŠ¶æ€)
  â”‚
  â”œâ”€â”€ æ‹–åŠ¨åˆ° 01:23:
  â”‚   01:23 â¸ï¸ å‘¨æ·± - èœƒæ¥¼  (é¢„è§ˆæ—¶é—´)
  â”‚
  â””â”€â”€ TouchUp å:
      01:23 â–¶ï¸ å‘¨æ·± - èœƒæ¥¼  (ç»§ç»­æ’­æ”¾)
```

### 5.2 é”å±æ‹–åŠ¨åœºæ™¯

```
ç”¨æˆ·é”å±ç•Œé¢
    â”‚
    â–¼
æ‹–åŠ¨è¿›åº¦æ¡åˆ° 02:30
    â”‚
    â–¼
changePlaybackPositionCommand è§¦å‘
    â”‚
    â”œâ”€â”€ è®°å½• wasPlaying = YES
    â”œâ”€â”€ è°ƒç”¨ pauseMusic()
    â”œâ”€â”€ åœæ­¢å®šæ—¶å™¨
    â”œâ”€â”€ seekToTime(150ç§’)
    â”œâ”€â”€ ç­‰å¾…è·³è½¬å®Œæˆ
    â””â”€â”€ æ¢å¤ playMusic()
    â”‚
    â–¼
éŸ³ä¹ä» 02:30 ç»§ç»­æ’­æ”¾
```

---

## å…­ã€å…³é”®ä»£ç æ±‡æ€»

### 6.1 éœ€è¦æ·»åŠ çš„å±æ€§ï¼ˆXCMusicPlayerViewControllerï¼‰

```objc
@interface XCMusicPlayerViewController ()
@property (nonatomic, assign) BOOL wasPlayingBeforeSeek;  // è°ƒæ•´å‰æ˜¯å¦æ’­æ”¾ä¸­
@property (nonatomic, assign) BOOL isSeeking;             // æ˜¯å¦æ­£åœ¨è°ƒæ•´
@end
```

### 6.2 éœ€è¦æ·»åŠ çš„æ–¹æ³•ï¼ˆXCMusicPlayerViewControllerï¼‰

```objc
// æ»‘å—äº‹ä»¶
- (void)sliderTouchDown:(UISlider *)slider;
- (void)sliderValueChanged:(UISlider *)slider;
- (void)sliderTouchUp:(UISlider *)slider;

// è¾…åŠ©æ–¹æ³•
- (void)seekToTime:(NSTimeInterval)time;
- (NSString *)formatTime:(NSTimeInterval)timeInterval;
- (void)updateLockScreenPreviewTime:(NSTimeInterval)time;
```

### 6.3 éœ€è¦ä¿®æ”¹çš„æ–¹æ³•ï¼ˆXCMusicPlayerModelï¼‰

```objc
// ä¿®æ”¹ setupRemoteCommands ä¸­çš„ changePlaybackPositionCommand
// æ·»åŠ æš‚åœ-è·³è½¬-æ¢å¤é€»è¾‘
```

---

## ä¸ƒã€è¾¹ç•Œæƒ…å†µå¤„ç†

### 7.1 ç”¨æˆ·å¿«é€Ÿç‚¹å‡»ï¼ˆä¸æ‹–åŠ¨ï¼‰

```objc
- (void)sliderTouchUp:(UISlider *)slider {
    // å³ä½¿å€¼æ²¡å˜ï¼Œä¹Ÿè¦å¤„ç†ï¼ˆç”¨æˆ·å¯èƒ½åªæ˜¯ç‚¹å‡»ï¼‰
    // ... æ­£å¸¸è·³è½¬é€»è¾‘ ...
}
```

### 7.2 æ‹–åŠ¨è¿‡ç¨‹ä¸­æ­Œæ›²ç»“æŸ

```objc
// åœ¨ seekToTime å‰æ£€æŸ¥æ­Œæ›²æ˜¯å¦è¿˜åœ¨
- (void)sliderTouchUp:(UISlider *)slider {
    if (!self.musicPlayerModel.nowPlayingSong) {
        return;  // æ­Œæ›²å·²åˆ‡æ¢æˆ–æ¸…ç©º
    }
    // ... æ­£å¸¸é€»è¾‘ ...
}
```

### 7.3 å¤šæ¬¡å¿«é€Ÿæ‹–åŠ¨

```objc
// æ¯æ¬¡ TouchDown éƒ½é‡æ–°è®°å½•çŠ¶æ€ï¼Œè¦†ç›–ä¹‹å‰çš„
- (void)sliderTouchDown:(UISlider *)slider {
    // å¦‚æœæ­£åœ¨è°ƒæ•´ä¸­ï¼Œå…ˆå–æ¶ˆä¹‹å‰çš„
    if (self.isSeeking) {
        [self cancelCurrentSeek];
    }
    // ... é‡æ–°å¼€å§‹ ...
}
```

### 7.4 seek æ“ä½œå¤±è´¥

```objc
[self.player seekToTime:targetCMTime completionHandler:^(BOOL finished) {
    if (!finished) {
        // è·³è½¬è¢«ä¸­æ–­ï¼ˆå¯èƒ½ç”¨æˆ·åˆæ‹–åŠ¨äº†ï¼‰
        NSLog(@"è·³è½¬è¢«å–æ¶ˆ");
        return;
    }
    // ... æ¢å¤æ’­æ”¾ ...
}];
```

---

## å…«ã€ç”¨æˆ·ä½“éªŒä¼˜åŒ–å»ºè®®

### 8.1 è§†è§‰åé¦ˆ

```objc
- (void)sliderTouchDown:(UISlider *)slider {
    // æš‚åœæ—¶ç»™ç”¨æˆ·è§†è§‰åé¦ˆ
    [UIView animateWithDuration:0.2 animations:^{
        self.mainView.playOrStopButton.alpha = 0.5;
    }];
}

- (void)sliderTouchUp:(UISlider *)slider {
    // æ¢å¤æ—¶è§†è§‰åé¦ˆ
    [UIView animateWithDuration:0.2 animations:^{
        self.mainView.playOrStopButton.alpha = 1.0;
    }];
}
```

### 8.2 éœ‡åŠ¨åé¦ˆ

```objc
- (void)sliderTouchUp:(UISlider *)slider {
    // æ¾æ‰‹æ—¶ç»™è½»å¾®éœ‡åŠ¨åé¦ˆ
    UIImpactFeedbackGenerator *feedback = [[UIImpactFeedbackGenerator alloc] initWithStyle:UIImpactFeedbackStyleLight];
    [feedback impactOccurred];
    
    // ... è·³è½¬é€»è¾‘ ...
}
```

### 8.3 æ—¶é—´æ ‡ç­¾è·Ÿéš

```objc
- (void)sliderValueChanged:(UISlider *)slider {
    // å¯ä»¥æ·»åŠ ä¸€ä¸ªæµ®åŠ¨æ ‡ç­¾è·Ÿéšæ»‘å— thumb æ˜¾ç¤ºæ—¶é—´
    CGPoint thumbCenter = [self thumbCenterForSlider:slider];
    self.floatingTimeLabel.center = CGPointMake(thumbCenter.x, thumbCenter.y - 30);
    self.floatingTimeLabel.text = [self formatTime:targetTime];
}
```

---

## ä¹ã€ä¸ç°æœ‰ä»£ç çš„æ•´åˆç‚¹

### 9.1 ä¸ç ´åç°æœ‰åŠŸèƒ½

```objc
// ç°æœ‰æ’­æ”¾/æš‚åœé€»è¾‘ä¿æŒä¸å˜
- (void)playMusic {
    // ... åŸæœ‰ä»£ç  ...
}

// åªæ˜¯æ·»åŠ æ–°çš„äº‹ä»¶ç›‘å¬
- (void)viewDidLoad {
    // ... åŸæœ‰ä»£ç  ...
    
    // æ–°å¢æ»‘å—ç›‘å¬
    [self setupSliderEventHandlers];  // æŠ½æˆæ–°æ–¹æ³•
}
```

### 9.2 å¤ç”¨ç°æœ‰æ–¹æ³•

```objc
// å¤ç”¨ model çš„ pauseMusic / playMusic
// å¤ç”¨ model çš„ stopLockScreenProgressTimer
// å¤ç”¨ model çš„ updateLockScreenInfo
```

---

## åã€æ€»ç»“

| æ­¥éª¤ | æ“ä½œ | å¯¹åº”ä»£ç  |
|------|------|----------|
| **è¯†åˆ«å¼€å§‹** | TouchDown / é”å±æ‹–åŠ¨ | `sliderTouchDown:` / `changePlaybackPositionCommand` |
| **æš‚åœ** | è°ƒç”¨ pauseMusic | `[self.musicPlayerModel pauseMusic]` |
| **è®°å½•çŠ¶æ€** | ä¿å­˜ wasPlaying | `self.wasPlayingBeforeSeek = ...` |
| **é¢„è§ˆ** | ValueChanged æ›´æ–°æ˜¾ç¤º | `sliderValueChanged:` |
| **æ‰§è¡Œè·³è½¬** | seekToTime | `[self.player seekToTime:...]` |
| **æ¢å¤** | å¦‚æœ wasPlaying åˆ™ play | `[self.musicPlayerModel playMusic]` |

è¿™å¥—æ–¹æ¡ˆç¡®ä¿äº† UI å’Œé”å±ä¸¤å¥—æ“ä½œçš„ä¸€è‡´ä½“éªŒï¼Œéµå¾ª iOS éŸ³ä¹æ’­æ”¾çš„æ ‡å‡†äº¤äº’æ¨¡å¼ã€‚
