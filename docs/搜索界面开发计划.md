# Spotify Clone - æœç´¢ç•Œé¢å¼€å‘è®¡åˆ’

> æ–‡æ¡£åˆ›å»ºæ—¥æœŸï¼š2026-02-08  
> ç›®æ ‡ï¼šå®Œæˆæœç´¢ç•Œé¢çš„å…¨éƒ¨åŠŸèƒ½å¼€å‘

---

## ä¸€ã€å½“å‰çŠ¶æ€åˆ†æ

### 1.1 å·²å®Œæˆéƒ¨åˆ†

| æ–‡ä»¶ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| `XCSearchViewController.h/m` | âš ï¸ åŸºç¡€æ¡†æ¶ | UISearchController å·²é…ç½®ï¼Œä½†æœç´¢é€»è¾‘ä¸ºç©º |
| `XCSearchView.h/m` | âš ï¸ ä»…å£°æ˜ | UITableView å·²å£°æ˜ï¼Œä½† UI æœªå®ç° |
| `XCSearchModel.h/m` | âš ï¸ ç©ºå®ç° | æ•°æ®æ¨¡å‹å’Œä¸šåŠ¡é€»è¾‘å¾…å¼€å‘ |

### 1.2 å­˜åœ¨é—®é¢˜

1. **æœç´¢åŠŸèƒ½æœªå®ç°** - `updateSearchResultsForSearchController:` æ–¹æ³•ä¸ºç©º
2. **UI å¸ƒå±€ç¼ºå¤±** - XCSearchView æœªå®Œæˆåˆå§‹åŒ–å¸ƒå±€
3. **æ•°æ®å±‚ç¼ºå¤±** - æ— æœç´¢è¯·æ±‚æ–¹æ³•å’Œæ•°æ®è§£æ
4. **æ— æœç´¢å†å²** - æœªå®ç°æœç´¢å†å²è®°å½•åŠŸèƒ½
5. **æ— ç»“æœå±•ç¤º** - æœç´¢ç»“æœåˆ—è¡¨ Cell æœªå®šä¹‰

---

## äºŒã€åŠŸèƒ½éœ€æ±‚åˆ†æ

### 2.1 æ ¸å¿ƒåŠŸèƒ½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æœç´¢ç•Œé¢åŠŸèƒ½æ¶æ„                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. æœç´¢è¾“å…¥                                         â”‚
â”‚     â”œâ”€â”€ å®æ—¶æœç´¢ï¼ˆè¾“å…¥æ—¶å³æ—¶è¯·æ±‚ï¼‰                    â”‚
â”‚     â”œâ”€â”€ æœç´¢å»ºè®®ï¼ˆæ¨¡ç³ŠåŒ¹é…ï¼‰                         â”‚
â”‚     â””â”€â”€ é”®ç›˜æœç´¢ï¼ˆç‚¹å‡»æœç´¢æŒ‰é’®è§¦å‘ï¼‰                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  2. æœç´¢ç»“æœå±•ç¤º                                     â”‚
â”‚     â”œâ”€â”€ å•æ›²ç»“æœï¼ˆæ­Œæ›²å+æ­Œæ‰‹+ä¸“è¾‘å°é¢ï¼‰              â”‚
â”‚     â”œâ”€â”€ ä¸“è¾‘ç»“æœï¼ˆä¸“è¾‘å+æ­Œæ‰‹+å°é¢ï¼‰                  â”‚
â”‚     â””â”€â”€ æ­Œæ‰‹ç»“æœï¼ˆæ­Œæ‰‹å+å¤´åƒï¼‰                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  3. æœç´¢å†å²                                         â”‚
â”‚     â”œâ”€â”€ æœ¬åœ°å­˜å‚¨ï¼ˆä½¿ç”¨ NSUserDefaultsï¼‰               â”‚
â”‚     â”œâ”€â”€ å†å²è®°å½•å±•ç¤ºï¼ˆæ¨ªå‘æ ‡ç­¾æˆ–åˆ—è¡¨ï¼‰                â”‚
â”‚     â””â”€â”€ ä¸€é”®æ¸…é™¤åŠŸèƒ½                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  4. çƒ­é—¨æœç´¢                                         â”‚
â”‚     â”œâ”€â”€ ä»æœåŠ¡å™¨è·å–çƒ­é—¨å…³é”®è¯                        â”‚
â”‚     â””â”€â”€ ç‚¹å‡»ç›´æ¥æœç´¢                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  5. äº¤äº’åŠŸèƒ½                                         â”‚
â”‚     â”œâ”€â”€ ç‚¹å‡»æ­Œæ›² -> æ’­æ”¾                             â”‚
â”‚     â”œâ”€â”€ ç‚¹å‡»ä¸“è¾‘ -> è¿›å…¥ä¸“è¾‘è¯¦æƒ…é¡µ                    â”‚
â”‚     â””â”€â”€ ç‚¹å‡»æ­Œæ‰‹ -> è¿›å…¥æ­Œæ‰‹è¯¦æƒ…é¡µï¼ˆé¢„ç•™ï¼‰            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ç•Œé¢åŸå‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ” æœç´¢æ­Œæ›²ã€æ­Œæ‰‹ã€ä¸“è¾‘...      â”‚  â† UISearchBar
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æœç´¢å†å²                    âœ•  â”‚  â† æ ‡é¢˜ + æ¸…é™¤æŒ‰é’®
â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚å‘¨æ°ä¼¦â”‚ â”‚æ™´å¤© â”‚ â”‚å¤œæ›² â”‚ ...  â”‚  â† å†å²æ ‡ç­¾æ¨ªå‘æ»šåŠ¨
â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  çƒ­é—¨æœç´¢                        â”‚
â”‚  1. æ—ä¿Šæ° - å…³é”®è¯              â”‚
â”‚  2. é™ˆå¥•è¿… - åå¹´                â”‚  â† çƒ­é—¨åˆ—è¡¨
â”‚  3. è–›ä¹‹è°¦ - æ¼”å‘˜                â”‚
â”‚  ...                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ï¼ˆæœç´¢åå±•ç¤ºç»“æœï¼‰              â”‚
â”‚  â”Œâ”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚å°é¢â”‚ æ­Œæ›²å            â–¶   â”‚ â”‚  â† æœç´¢ç»“æœåˆ—è¡¨
â”‚  â”‚   â”‚ æ­Œæ‰‹ - ä¸“è¾‘             â”‚ â”‚
â”‚  â””â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚å°é¢â”‚ æ­Œæ›²å            â–¶   â”‚ â”‚
â”‚  â”‚   â”‚ æ­Œæ‰‹ - ä¸“è¾‘             â”‚ â”‚
â”‚  â””â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸‰ã€API æ¥å£è°ƒç ”

### 3.1 ç½‘æ˜“äº‘ API æœç´¢æ¥å£

åŸºäºé¡¹ç›®ç°æœ‰ API åŸºç¡€ `https://1390963969-2g6ivueiij.ap-guangzhou.tencentscf.com`

```
GET /search
å‚æ•°ï¼š
  - keywords: æœç´¢å…³é”®è¯ï¼ˆå¿…å¡«ï¼‰
  - type: æœç´¢ç±»å‹ï¼ˆå¯é€‰ï¼Œé»˜è®¤1ï¼‰
    - 1: å•æ›²
    - 10: ä¸“è¾‘
    - 100: æ­Œæ‰‹
    - 1000: æ­Œå•
  - limit: è¿”å›æ•°é‡ï¼ˆé»˜è®¤30ï¼‰
  - offset: åç§»é‡ï¼ˆé»˜è®¤0ï¼‰
```

### 3.2 å“åº”æ•°æ®ç»“æ„

```json
{
  "result": {
    "songs": [
      {
        "id": 123456,
        "name": "æ­Œæ›²å",
        "artists": [{"id": 111, "name": "æ­Œæ‰‹å"}],
        "album": {"id": 222, "name": "ä¸“è¾‘å", "picUrl": "å°é¢URL"},
        "duration": 240000
      }
    ],
    "songCount": 100
  }
}
```

---

## å››ã€å¼€å‘ä»»åŠ¡åˆ†è§£

### 4.1 ä»»åŠ¡æ¸…å•

| åºå· | ä»»åŠ¡ | ä¼˜å…ˆçº§ | é¢„è®¡å·¥æ—¶ | æ¶‰åŠæ–‡ä»¶ |
|------|------|--------|----------|----------|
| 1 | åˆ›å»ºæœç´¢ç»“æœæ•°æ®æ¨¡å‹ | ğŸ”´ é«˜ | 1h | XCSearchResultData.h/m |
| 2 | å®ç°æœç´¢ç½‘ç»œè¯·æ±‚æ–¹æ³• | ğŸ”´ é«˜ | 2h | XCNetworkManager.h/m |
| 3 | å®Œå–„ XCSearchModel ä¸šåŠ¡é€»è¾‘ | ğŸ”´ é«˜ | 2h | XCSearchModel.h/m |
| 4 | åˆ›å»ºæœç´¢ç»“æœ Cell | ğŸ”´ é«˜ | 2h | XCSearchResultCell.h/m |
| 5 | å®Œå–„ XCSearchView UI å¸ƒå±€ | ğŸ”´ é«˜ | 2h | XCSearchView.h/m |
| 6 | å®Œå–„ XCSearchViewController | ğŸ”´ é«˜ | 3h | XCSearchViewController.h/m |
| 7 | å®ç°æœç´¢å†å²åŠŸèƒ½ | ğŸŸ¡ ä¸­ | 2h | XCSearchHistoryManager.h/m |
| 8 | å®ç°çƒ­é—¨æœç´¢åŠŸèƒ½ | ğŸŸ¡ ä¸­ | 1.5h | XCSearchViewController.m |
| 9 | æœç´¢é˜²æŠ–ä¼˜åŒ– | ğŸŸ¡ ä¸­ | 1h | XCSearchViewController.m |
| 10 | ç©ºçŠ¶æ€å’ŒåŠ è½½çŠ¶æ€ | ğŸŸ¡ ä¸­ | 1.5h | XCSearchView.m |
| 11 | æµ‹è¯•å’Œ Bug ä¿®å¤ | ğŸŸ¢ ä½ | 2h | å…¨éƒ¨ |

### 4.2 å¼€å‘é˜¶æ®µè§„åˆ’

```
ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€åŠŸèƒ½ï¼ˆé¢„è®¡ 12 å°æ—¶ï¼‰
â”œâ”€â”€ Day 1: æ•°æ®å±‚å¼€å‘
â”‚   â”œâ”€â”€ åˆ›å»º XCSearchResultData æ¨¡å‹
â”‚   â”œâ”€â”€ åœ¨ XCNetworkManager æ·»åŠ æœç´¢ API æ–¹æ³•
â”‚   â””â”€â”€ å®Œå–„ XCSearchModel ä¸šåŠ¡é€»è¾‘
â”‚
â”œâ”€â”€ Day 2: UI å±‚å¼€å‘
â”‚   â”œâ”€â”€ åˆ›å»º XCSearchResultCell
â”‚   â”œâ”€â”€ å®Œå–„ XCSearchView å¸ƒå±€
â”‚   â””â”€â”€ å®Œå–„ XCSearchViewController
â”‚
â””â”€â”€ Day 3: è”è°ƒæµ‹è¯•
    â”œâ”€â”€ æœç´¢åŠŸèƒ½è”è°ƒ
    â””â”€â”€ åŸºç¡€ Bug ä¿®å¤

ç¬¬äºŒé˜¶æ®µï¼šå¢å¼ºåŠŸèƒ½ï¼ˆé¢„è®¡ 6 å°æ—¶ï¼‰
â”œâ”€â”€ Day 4: æœç´¢å†å²
â”‚   â”œâ”€â”€ åˆ›å»º XCSearchHistoryManager
â”‚   â””â”€â”€ é›†æˆå†å²è®°å½• UI
â”‚
â”œâ”€â”€ Day 5: ä¼˜åŒ–å®Œå–„
â”‚   â”œâ”€â”€ çƒ­é—¨æœç´¢
â”‚   â”œâ”€â”€ é˜²æŠ–ä¼˜åŒ–
â”‚   â”œâ”€â”€ ç©ºçŠ¶æ€/åŠ è½½çŠ¶æ€
â”‚   â””â”€â”€ æœ€ç»ˆæµ‹è¯•
```

---

## äº”ã€è¯¦ç»†è®¾è®¡æ–¹æ¡ˆ

### 5.1 æ•°æ®å±‚è®¾è®¡

#### 5.1.1 æœç´¢ç»“æœæ•°æ®æ¨¡å‹ (XCSearchResultData.h)

```objc
#import <Foundation/Foundation.h>
#import <YYModel/YYModel.h>

NS_ASSUME_NONNULL_BEGIN

typedef NS_ENUM(NSInteger, XCSearchResultType) {
    XCSearchResultTypeSong = 1,       // å•æ›²
    XCSearchResultTypeAlbum = 10,     // ä¸“è¾‘
    XCSearchResultTypeArtist = 100,   // æ­Œæ‰‹
    XCSearchResultTypePlaylist = 1000 // æ­Œå•
};

@interface XCSearchResultData : NSObject <YYModel>

#pragma mark - é€šç”¨å±æ€§
@property (nonatomic, assign) XCSearchResultType resultType;
@property (nonatomic, copy) NSString *resultId;
@property (nonatomic, copy) NSString *name;
@property (nonatomic, copy) NSString *imageUrl;

#pragma mark - å•æ›²ç‰¹æœ‰
@property (nonatomic, copy) NSString *songId;
@property (nonatomic, copy) NSString *artistName;
@property (nonatomic, copy) NSString *albumName;
@property (nonatomic, assign) NSInteger duration; // æ¯«ç§’

#pragma mark - ä¸“è¾‘/æ­Œå•ç‰¹æœ‰
@property (nonatomic, copy) NSString *creatorName;
@property (nonatomic, assign) NSInteger trackCount;

#pragma mark - æ­Œæ‰‹ç‰¹æœ‰
@property (nonatomic, assign) NSInteger albumSize;
@property (nonatomic, assign) NSInteger musicSize;

#pragma mark - è®¡ç®—å±æ€§
@property (nonatomic, copy, readonly) NSString *durationText;

@end

NS_ASSUME_NONNULL_END
```

#### 5.1.2 æœç´¢å†å²ç®¡ç†å™¨ (XCSearchHistoryManager.h)

```objc
#import <Foundation/Foundation.h>

NS_ASSUME_NONNULL_BEGIN

@interface XCSearchHistoryManager : NSObject

+ (instancetype)sharedInstance;

// è·å–æ‰€æœ‰å†å²è®°å½•
- (NSArray<NSString *> *)getAllHistory;

// æ·»åŠ æœç´¢è®°å½•
- (void)addSearchKeyword:(NSString *)keyword;

// åˆ é™¤å•æ¡è®°å½•
- (void)removeSearchKeyword:(NSString *)keyword;

// æ¸…ç©ºæ‰€æœ‰è®°å½•
- (void)clearAllHistory;

// æœ€å¤§è®°å½•æ•°ï¼ˆé»˜è®¤ 20ï¼‰
@property (nonatomic, assign) NSInteger maxHistoryCount;

@end

NS_ASSUME_NONNULL_END
```

#### 5.1.3 å®Œå–„ XCSearchModel

```objc
#import <Foundation/Foundation.h>
#import "XCSearchResultData.h"

NS_ASSUME_NONNULL_BEGIN

@interface XCSearchModel : NSObject

#pragma mark - æ•°æ®å±æ€§
@property (nonatomic, strong) NSMutableArray<XCSearchResultData *> *searchResults;
@property (nonatomic, strong) NSMutableArray<NSString *> *hotSearchKeywords;
@property (nonatomic, copy) NSString *currentKeyword;
@property (nonatomic, assign) BOOL isLoading;
@property (nonatomic, assign) NSInteger currentOffset;
@property (nonatomic, assign) BOOL hasMore;

#pragma mark - æœç´¢æ–¹æ³•
/// æ‰§è¡Œæœç´¢
- (void)searchWithKeyword:(NSString *)keyword
                     type:(XCSearchResultType)type
               completion:(void(^)(BOOL success, NSString * _Nullable errorMsg))completion;

/// åŠ è½½æ›´å¤š
- (void)loadMoreWithCompletion:(void(^)(BOOL success))completion;

/// è·å–çƒ­é—¨æœç´¢
- (void)fetchHotSearchWithCompletion:(void(^)(BOOL success))completion;

#pragma mark - æ•°æ®è½¬æ¢
/// è·å–æ­Œæ›²æ’­æ”¾æ•°æ®
- (XC_YYSongData *)getSongDataFromResult:(XCSearchResultData *)result;

@end

NS_ASSUME_NONNULL_END
```

---

### 5.2 ç½‘ç»œå±‚æ‰©å±•

#### 5.2.1 XCNetworkManager æ–°å¢æ–¹æ³•

```objc
#pragma mark - æœç´¢ç›¸å…³æ¥å£

/// æœç´¢æ­Œæ›²/ä¸“è¾‘/æ­Œæ‰‹
/// @param keyword æœç´¢å…³é”®è¯
/// @param type æœç´¢ç±»å‹ 1=å•æ›² 10=ä¸“è¾‘ 100=æ­Œæ‰‹ 1000=æ­Œå•
/// @param offset åç§»é‡
/// @param limit è¿”å›æ•°é‡
/// @param completion å›è°ƒ
- (void)searchWithKeyword:(NSString *)keyword
                     type:(NSInteger)type
                   offset:(NSInteger)offset
                    limit:(NSInteger)limit
               completion:(void(^)(NSArray<XCSearchResultData *> * _Nullable results, 
                                   BOOL hasMore, 
                                   NSError * _Nullable error))completion;

/// è·å–çƒ­é—¨æœç´¢å…³é”®è¯
- (void)getHotSearchKeywordsWithCompletion:(void(^)(NSArray<NSString *> * _Nullable keywords, 
                                                     NSError * _Nullable error))completion;
```

### 5.3 UI å±‚è®¾è®¡

#### 5.3.1 æœç´¢ç»“æœ Cell (XCSearchResultCell)

```objc
#import <UIKit/UIKit.h>
#import "XCSearchResultData.h"

NS_ASSUME_NONNULL_BEGIN

@interface XCSearchResultCell : UITableViewCell

@property (nonatomic, strong) XCSearchResultData *data;
@property (nonatomic, strong) UIImageView *coverImageView;
@property (nonatomic, strong) UILabel *titleLabel;
@property (nonatomic, strong) UILabel *subtitleLabel;
@property (nonatomic, strong) UIButton *playButton;

- (void)configureWithData:(XCSearchResultData *)data;

@end

NS_ASSUME_NONNULL_END
```

**Cell å¸ƒå±€å‚è€ƒï¼š**
- å·¦ä¾§ï¼š50x50 åœ†è§’å°é¢å›¾ï¼ˆSDWebImage åŠ è½½ï¼‰
- ä¸­é—´ï¼šæ­Œæ›²åï¼ˆä¸»æ ‡é¢˜ï¼‰+ æ­Œæ‰‹ - ä¸“è¾‘ï¼ˆå‰¯æ ‡é¢˜ï¼‰
- å³ä¾§ï¼šæ’­æ”¾æŒ‰é’®ï¼ˆå•æ›²ï¼‰æˆ–ç®­å¤´ï¼ˆä¸“è¾‘/æ­Œæ‰‹ï¼‰

#### 5.3.2 XCSearchView å¸ƒå±€ç»“æ„

```objc
@interface XCSearchView : UIView

#pragma mark - ä¸»è¦è§†å›¾
@property (nonatomic, strong) UITableView *resultTableView;

#pragma mark - æœç´¢å†å²å’Œçƒ­é—¨æœç´¢è§†å›¾
@property (nonatomic, strong) UIView *historyContainerView;
@property (nonatomic, strong) UIScrollView *historyScrollView;
@property (nonatomic, strong) UIView *hotSearchContainerView;
@property (nonatomic, strong) UITableView *hotSearchTableView;

#pragma mark - ç©ºçŠ¶æ€å’ŒåŠ è½½è§†å›¾
@property (nonatomic, strong) UIView *emptyStateView;
@property (nonatomic, strong) UIActivityIndicatorView *loadingIndicator;
@property (nonatomic, strong) UILabel *emptyStateLabel;

#pragma mark - æ–¹æ³•
- (void)showHistoryView;
- (void)showHotSearchView;
- (void)showResultView;
- (void)showEmptyStateWithText:(NSString *)text;
- (void)showLoading;
- (void)hideLoading;

@end
```

#### 5.3.3 XCSearchViewController å®Œå–„

```objc
@interface XCSearchViewController : UIViewController <
    UISearchResultsUpdating, 
    UISearchBarDelegate,
    UITableViewDelegate, 
    UITableViewDataSource
>

@property (nonatomic, strong) XCSearchView *mainView;
@property (nonatomic, strong) XCSearchModel *model;
@property (nonatomic, strong) UISearchController *searchController;

// é˜²æŠ–å®šæ—¶å™¨
@property (nonatomic, strong) NSTimer *searchTimer;

@end
```

### 5.4 äº¤äº’æµç¨‹è®¾è®¡

```
ç”¨æˆ·è¾“å…¥å…³é”®è¯
     â”‚
     â–¼
è§¦å‘ updateSearchResultsForSearchController
     â”‚
     â–¼
å–æ¶ˆä¹‹å‰çš„å®šæ—¶å™¨ï¼ˆé˜²æŠ–ï¼‰
     â”‚
     â–¼
åˆ›å»ºæ–°çš„ 0.5s å®šæ—¶å™¨
     â”‚
     â–¼
å®šæ—¶å™¨è§¦å‘ -> æ‰§è¡Œæœç´¢è¯·æ±‚
     â”‚
     â–¼
XCNetworkManager å‘èµ·ç½‘ç»œè¯·æ±‚
     â”‚
     â–¼
è§£ææ•°æ® -> XCSearchResultData æ•°ç»„
     â”‚
     â–¼
æ›´æ–° XCSearchModel.searchResults
     â”‚
     â–¼
å‘é€é€šçŸ¥æˆ–ç›´æ¥åˆ·æ–° TableView
     â”‚
     â–¼
XCSearchView.resultTableView reloadData
     â”‚
     â–¼
å±•ç¤ºæœç´¢ç»“æœ
```

---

## å…­ã€å…³é”®ä»£ç å®ç°å‚è€ƒ

### 6.1 æœç´¢é˜²æŠ–å®ç°

```objc
#pragma mark - UISearchResultsUpdating

- (void)updateSearchResultsForSearchController:(UISearchController *)searchController {
    NSString *searchText = searchController.searchBar.text;
    
    // å–æ¶ˆä¹‹å‰çš„å®šæ—¶å™¨
    [self.searchTimer invalidate];
    self.searchTimer = nil;
    
    // ç©ºå†…å®¹ä¸æœç´¢
    if (searchText.length == 0) {
        [self.mainView showHistoryView];
        return;
    }
    
    // åˆ›å»ºæ–°çš„å®šæ—¶å™¨ï¼Œ0.5ç§’åæ‰§è¡Œæœç´¢
    self.searchTimer = [NSTimer scheduledTimerWithTimeInterval:0.5
                                                        target:self
                                                      selector:@selector(performSearch:)
                                                      userInfo:@{@"keyword": searchText}
                                                       repeats:NO];
}

- (void)performSearch:(NSTimer *)timer {
    NSString *keyword = timer.userInfo[@"keyword"];
    
    [self.mainView showLoading];
    
    [self.model searchWithKeyword:keyword
                             type:XCSearchResultTypeSong
                       completion:^(BOOL success, NSString * _Nullable errorMsg) {
        dispatch_async(dispatch_get_main_queue(), ^{
            [self.mainView hideLoading];
            if (success) {
                [self.mainView showResultView];
                [self.mainView.resultTableView reloadData];
                // ä¿å­˜æœç´¢å†å²
                [[XCSearchHistoryManager sharedInstance] addSearchKeyword:keyword];
            } else {
                [self.mainView showEmptyStateWithText:errorMsg ?: @"æœç´¢å¤±è´¥"];
            }
        });
    }];
}
```

### 6.2 æœç´¢å†å²æ ‡ç­¾å¸ƒå±€

```objc
- (void)setupHistoryTags:(NSArray<NSString *> *)historyKeywords {
    // æ¸…é™¤æ—§æ ‡ç­¾
    for (UIView *subview in self.historyScrollView.subviews) {
        [subview removeFromSuperview];
    }
    
    CGFloat xOffset = 16;
    CGFloat padding = 10;
    
    for (NSString *keyword in historyKeywords) {
        UIButton *tagBtn = [UIButton buttonWithType:UIButtonTypeRoundedRect];
        [tagBtn setTitle:keyword forState:UIControlStateNormal];
        [tagBtn addTarget:self action:@selector(historyTagTapped:) 
         forControlEvents:UIControlEventTouchUpInside];
        
        // è®¡ç®—å®½åº¦
        CGSize textSize = [keyword boundingRectWithSize:CGSizeMake(MAXFLOAT, 30)
                                                options:NSStringDrawingUsesLineFragmentOrigin
                                             attributes:@{NSFontAttributeName: [UIFont systemFontOfSize:14]}
                                                context:nil].size;
        CGFloat btnWidth = textSize.width + 20;
        
        tagBtn.frame = CGRectMake(xOffset, 5, btnWidth, 30);
        tagBtn.backgroundColor = [UIColor secondarySystemBackgroundColor];
        tagBtn.layer.cornerRadius = 15;
        
        [self.historyScrollView addSubview:tagBtn];
        xOffset += btnWidth + padding;
    }
    
    self.historyScrollView.contentSize = CGSizeMake(xOffset, 40);
}
```

### 6.3 æœç´¢ç»“æœ Cell å¸ƒå±€å®ç°

```objc
- (void)setupUI {
    // å°é¢å›¾
    self.coverImageView = [[UIImageView alloc] init];
    self.coverImageView.contentMode = UIViewContentModeScaleAspectFill;
    self.coverImageView.layer.cornerRadius = 4;
    self.coverImageView.clipsToBounds = YES;
    [self.contentView addSubview:self.coverImageView];
    
    // æ ‡é¢˜
    self.titleLabel = [[UILabel alloc] init];
    self.titleLabel.font = [UIFont systemFontOfSize:16 weight:UIFontWeightMedium];
    self.titleLabel.textColor = [UIColor labelColor];
    [self.contentView addSubview:self.titleLabel];
    
    // å‰¯æ ‡é¢˜
    self.subtitleLabel = [[UILabel alloc] init];
    self.subtitleLabel.font = [UIFont systemFontOfSize:13];
    self.subtitleLabel.textColor = [UIColor secondaryLabelColor];
    [self.contentView addSubview:self.subtitleLabel];
    
    // æ’­æ”¾æŒ‰é’®
    self.playButton = [UIButton buttonWithType:UIButtonTypeSystem];
    [self.playButton setImage:[UIImage systemImageNamed:@"play.fill"] forState:UIControlStateNormal];
    [self.contentView addSubview:self.playButton];
    
    // ä½¿ç”¨ Masonry å¸ƒå±€
    [self.coverImageView mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.equalTo(self.contentView).offset(16);
        make.centerY.equalTo(self.contentView);
        make.size.mas_equalTo(CGSizeMake(50, 50));
    }];
    
    [self.playButton mas_makeConstraints:^(MASConstraintMaker *make) {
        make.right.equalTo(self.contentView).offset(-16);
        make.centerY.equalTo(self.contentView);
        make.size.mas_equalTo(CGSizeMake(30, 30));
    }];
    
    [self.titleLabel mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.equalTo(self.coverImageView.mas_right).offset(12);
        make.right.equalTo(self.playButton.mas_left).offset(-8);
        make.top.equalTo(self.contentView).offset(12);
    }];
    
    [self.subtitleLabel mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.right.equalTo(self.titleLabel);
        make.top.equalTo(self.titleLabel.mas_bottom).offset(4);
    }];
}

- (void)configureWithData:(XCSearchResultData *)data {
    self.data = data;
    
    // è®¾ç½®æ ‡é¢˜
    self.titleLabel.text = data.name;
    
    // æ ¹æ®ç±»å‹è®¾ç½®å‰¯æ ‡é¢˜
    if (data.resultType == XCSearchResultTypeSong) {
        self.subtitleLabel.text = [NSString stringWithFormat:@"%@ - %@", 
                                   data.artistName, data.albumName];
        self.playButton.hidden = NO;
    } else if (data.resultType == XCSearchResultTypeAlbum) {
        self.subtitleLabel.text = [NSString stringWithFormat:@"ä¸“è¾‘ Â· %@", 
                                   data.creatorName];
        self.playButton.hidden = YES;
    }
    
    // åŠ è½½å›¾ç‰‡
    [self.coverImageView sd_setImageWithURL:[NSURL URLWithString:data.imageUrl]
                           placeholderImage:[UIImage systemImageNamed:@"music.note"]];
}
```

---

## ä¸ƒã€é¡¹ç›®æ–‡ä»¶å˜æ›´æ¸…å•

### 7.1 æ–°å¢æ–‡ä»¶

```
Spotify - clone/
â”œâ”€â”€ æ•°æ®ç»“æ„/
â”‚   â””â”€â”€ XCSearchResultData.h/m          # æœç´¢ç»“æœæ•°æ®æ¨¡å‹ï¼ˆæ–°å»ºï¼‰
â”‚
â”œâ”€â”€ 5. TabBaré™„åŠ è§†å›¾ï¼Œæœç´¢éƒ¨åˆ†/
â”‚   â””â”€â”€ 2. æœç´¢/
â”‚       â”œâ”€â”€ XCSearchHistoryManager.h/m   # æœç´¢å†å²ç®¡ç†å™¨ï¼ˆæ–°å»ºï¼‰
â”‚       â””â”€â”€ cells/
â”‚           â””â”€â”€ XCSearchResultCell.h/m   # æœç´¢ç»“æœ Cellï¼ˆæ–°å»ºï¼‰
```

### 7.2 ä¿®æ”¹æ–‡ä»¶

```
Spotify - clone/
â”œâ”€â”€ 6. ç½‘ç»œè¯·æ±‚éƒ¨åˆ†/
â”‚   â”œâ”€â”€ XCNetworkManager.h              # æ·»åŠ æœç´¢ API å£°æ˜
â”‚   â””â”€â”€ XCNetworkManager.m              # å®ç°æœç´¢ç½‘ç»œè¯·æ±‚
â”‚
â””â”€â”€ 5. TabBaré™„åŠ è§†å›¾ï¼Œæœç´¢éƒ¨åˆ†/
    â””â”€â”€ 2. æœç´¢/
        â”œâ”€â”€ XCSearchModel.h/m           # å®Œå–„ä¸šåŠ¡é€»è¾‘
        â”œâ”€â”€ XCSearchView.h/m            # å®Œå–„ UI å¸ƒå±€
        â””â”€â”€ XCSearchViewController.h/m  # å®Œå–„æ§åˆ¶å™¨é€»è¾‘
```

---

## å…«ã€ä¾èµ–åº“æ£€æŸ¥

ç¡®è®¤ä»¥ä¸‹ä¾èµ–å·²åœ¨ Podfile ä¸­ï¼š

```ruby
# å·²æœ‰ä¾èµ–ï¼ˆç¡®ä¿å¯ç”¨ï¼‰
pod 'AFNetworking', '~> 4.0.1'      # ç½‘ç»œè¯·æ±‚
pod 'YYModel', '~> 1.0.4'           # JSON è§£æ
pod 'SDWebImage', '~> 5.21.3'       # å›¾ç‰‡åŠ è½½
pod 'Masonry', '~> 1.1.0'           # å¸ƒå±€
```

---

## ä¹ã€æµ‹è¯•è®¡åˆ’

### 9.1 åŠŸèƒ½æµ‹è¯•ç”¨ä¾‹

| æµ‹è¯•é¡¹ | æµ‹è¯•æ­¥éª¤ | é¢„æœŸç»“æœ |
|--------|----------|----------|
| æœç´¢è¾“å…¥ | åœ¨æœç´¢æ¡†è¾“å…¥"å‘¨æ°ä¼¦" | 0.5ç§’åæ˜¾ç¤ºæœç´¢ç»“æœ |
| é˜²æŠ–åŠŸèƒ½ | å¿«é€Ÿè¾“å…¥"å‘¨æ°"ç„¶åç«‹å³åˆ é™¤ | ä¸è§¦å‘æœç´¢è¯·æ±‚ |
| ç»“æœå±•ç¤º | æœç´¢"æ™´å¤©" | æ˜¾ç¤º"æ™´å¤©"æ­Œæ›²åˆ—è¡¨ |
| ç‚¹å‡»æ’­æ”¾ | ç‚¹å‡»æœç´¢ç»“æœä¸­çš„æ­Œæ›² | å¼€å§‹æ’­æ”¾è¯¥æ­Œæ›² |
| å†å²è®°å½• | æœç´¢"ä¸ƒé‡Œé¦™"åè¿”å› | å†å²è®°å½•æ˜¾ç¤º"ä¸ƒé‡Œé¦™" |
| æ¸…ç©ºå†å² | ç‚¹å‡»æ¸…é™¤æŒ‰é’® | å†å²è®°å½•ä¸ºç©º |
| å†å²ç‚¹å‡» | ç‚¹å‡»å†å²æ ‡ç­¾ | è‡ªåŠ¨å¡«å……å¹¶æœç´¢ |
| ç©ºçŠ¶æ€ | æœç´¢"abcxyz123" | æ˜¾ç¤º"æ— æœç´¢ç»“æœ" |
| åŠ è½½çŠ¶æ€ | æœç´¢æ—¶è§‚å¯Ÿ UI | æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨ |
| åŠ è½½æ›´å¤š | æ»‘åŠ¨åˆ°åº•éƒ¨ | åŠ è½½æ›´å¤šç»“æœ |

### 9.2 æ€§èƒ½æµ‹è¯•

- æœç´¢å“åº”æ—¶é—´ < 1s
- å›¾ç‰‡åŠ è½½æµç•…æ— å¡é¡¿
- åˆ—è¡¨æ»‘åŠ¨ 60fps
- å†…å­˜å ç”¨ç¨³å®šï¼Œæ— æ³„æ¼

---

## åã€é£é™©è¯„ä¼°

| é£é™© | å¯èƒ½æ€§ | å½±å“ | åº”å¯¹æªæ–½ |
|------|--------|------|----------|
| ç½‘æ˜“äº‘ API ä¸ç¨³å®š | ä¸­ | é«˜ | å®ç°é‡è¯•æœºåˆ¶å’Œé”™è¯¯æç¤º |
| æœç´¢ç»“æœä¸ºç©º | ä½ | ä¸­ | å®Œå–„ç©ºçŠ¶æ€ UI |
| æœç´¢å†å²å­˜å‚¨è¿‡å¤š | ä½ | ä½ | é™åˆ¶æœ€å¤§å­˜å‚¨æ•°é‡ |
| å¿«é€Ÿè¾“å…¥å¯¼è‡´è¯·æ±‚å †ç§¯ | ä¸­ | ä¸­ | é˜²æŠ–å¤„ç† + è¯·æ±‚å–æ¶ˆ |
| å›¾ç‰‡åŠ è½½æ…¢å¯¼è‡´å¡é¡¿ | ä½ | ä¸­ | SDWebImage å¼‚æ­¥åŠ è½½ + å ä½å›¾ |

---

## åä¸€ã€å®Œæˆæ ‡å‡†

- [ ] æœç´¢åŠŸèƒ½å¯æ­£å¸¸ä½¿ç”¨ï¼Œè¾“å…¥å…³é”®è¯åå±•ç¤ºç»“æœ
- [ ] ç‚¹å‡»æœç´¢ç»“æœå¯æ’­æ”¾æ­Œæ›²æˆ–è¿›å…¥ä¸“è¾‘è¯¦æƒ…
- [ ] æœç´¢å†å²åŠŸèƒ½æ­£å¸¸ï¼Œå¯è®°å½•ã€å±•ç¤ºã€æ¸…é™¤å†å²
- [ ] çƒ­é—¨æœç´¢åŠŸèƒ½æ­£å¸¸ï¼Œç‚¹å‡»å¯ç›´æ¥æœç´¢
- [ ] UI ä¸ç°æœ‰ App é£æ ¼ä¸€è‡´ï¼Œä½¿ç”¨ Masonry å¸ƒå±€
- [ ] ä»£ç ç¬¦åˆé¡¹ç›®è§„èŒƒï¼Œæœ‰é€‚å½“çš„ä¸­æ–‡æ³¨é‡Š
- [ ] æ— æ˜æ˜¾ Bug å’Œå´©æºƒé—®é¢˜
- [ ] æœç´¢é˜²æŠ–ä¼˜åŒ–ç”Ÿæ•ˆ

---

## åäºŒã€é™„å½•

### 12.1 ç°æœ‰é¡¹ç›®å‚è€ƒä»£ç 

**ç½‘ç»œè¯·æ±‚ç¤ºä¾‹ï¼ˆå‚è€ƒ XCNetworkManagerï¼‰ï¼š**
```objc
AFHTTPSessionManager *manager = [AFHTTPSessionManager manager];
manager.responseSerializer.acceptableContentTypes = 
    [NSSet setWithObjects:@"application/json", @"text/json", 
                        @"text/javascript", @"text/html", @"text/plain", nil];

[manager GET:requestUrl
  parameters:params
     headers:nil
    progress:nil
     success:^(NSURLSessionDataTask * _Nonnull task, id _Nullable responseObject) {
    // è§£ææ•°æ®
} failure:^(NSURLSessionDataTask * _Nullable task, NSError * _Nonnull error) {
    // å¤„ç†é”™è¯¯
}];
```

**YYModel è§£æç¤ºä¾‹ï¼š**
```objc
NSArray<XCSearchResultData *> *results = 
    [NSArray yy_modelArrayWithClass:[XCSearchResultData class] json:jsonArray];
```

**SDWebImage åŠ è½½å›¾ç‰‡ç¤ºä¾‹ï¼š**
```objc
[imageView sd_setImageWithURL:[NSURL URLWithString:imageUrl]
             placeholderImage:[UIImage systemImageNamed:@"music.note"]];
```

### 12.2 ç½‘æ˜“äº‘ API å‚è€ƒèµ„æ–™

- æœç´¢æ¥å£ï¼š`/search?keywords=å…³é”®è¯&type=1&limit=30&offset=0`
- çƒ­é—¨æœç´¢ï¼š`/search/hot` æˆ– `/search/hot/detail`
- æœç´¢å»ºè®®ï¼š`/search/suggest?keywords=å…³é”®è¯&type=mobile`

### 12.3 UI è®¾è®¡è§„èŒƒ

| å…ƒç´  | è§„æ ¼ |
|------|------|
| èƒŒæ™¯è‰² | `[UIColor systemBackgroundColor]` |
| ä¸»æ–‡å­—é¢œè‰² | `[UIColor labelColor]` |
| å‰¯æ–‡å­—é¢œè‰² | `[UIColor secondaryLabelColor]` |
| ä¸»é¢˜è‰² | `[UIColor systemGreenColor]` |
| Cell é«˜åº¦ | 70pt |
| å°é¢å›¾å°ºå¯¸ | 50x50ptï¼Œåœ†è§’ 4pt |
| æ ‡é¢˜å­—ä½“ | System 16pt Medium |
| å‰¯æ ‡é¢˜å­—ä½“ | System 13pt Regular |

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¶é—´**: 2026-02-08  
**æœ€åæ›´æ–°**: 2026-02-08

---

> ğŸ’¡ **æç¤º**ï¼šæœ¬è®¡åˆ’æŒ‰ç…§ MVVM æ¶æ„è®¾è®¡ï¼Œä¸ç°æœ‰é¡¹ç›®é£æ ¼ä¿æŒä¸€è‡´ã€‚å»ºè®®æŒ‰é˜¶æ®µè¿›è¡Œå¼€å‘ï¼Œæ¯å®Œæˆä¸€ä¸ªé˜¶æ®µåè¿›è¡Œæµ‹è¯•éªŒè¯ã€‚
