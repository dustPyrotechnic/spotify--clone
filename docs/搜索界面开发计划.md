---
NotionID-Notion: 301fe9f6-0608-8154-8a12-da7e5c16c3d2
link-Notion: https://www.notion.so/301fe9f6060881548a12da7e5c16c3d2
autosync-database:
  - Notion
---
# Spotify Clone - æœç´¢ç•Œé¢å¼€å‘è®¡åˆ’

> æ–‡æ¡£åˆ›å»ºæ—¥æœŸï¼š2026-02-08  
> ç›®æ ‡ï¼šå®Œæˆæœç´¢ç•Œé¢çš„å…¨éƒ¨åŠŸèƒ½å¼€å‘

---

## ä¸€ã€å½“å‰çŠ¶æ€åˆ†æ

### 1.1 å·²å®Œæˆéƒ¨åˆ†

| æ–‡ä»¶ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| `XCSearchViewController.h/m` | âš ï¸ åŸºç¡€æ¡†æ¶ | UISearchController å·²é…ç½®ï¼Œä½†æœç´¢é€»è¾‘ä¸ºç©º |
| `XCSearchView.h/m` | âš ï¸ ä»…å£°æ˜ | UITableView å·²å£°æ˜ï¼Œä½† UI æœªå®ç° |
| `XCSearchModel.h/m` | âš ï¸ ç©ºå®ç° | æ•°æ®æ¨¡å‹å’Œä¸šåŠ¡é€»è¾‘å¾…å¼€å‘ |

### 1.2 å­˜åœ¨é—®é¢˜

1. **æœç´¢åŠŸèƒ½æœªå®ç°** - `updateSearchResultsForSearchController:` æ–¹æ³•ä¸ºç©º
2. **UI å¸ƒå±€ç¼ºå¤±** - XCSearchView æœªå®Œæˆåˆå§‹åŒ–å¸ƒå±€
3. **æ•°æ®å±‚ç¼ºå¤±** - æ— æœç´¢è¯·æ±‚æ–¹æ³•å’Œæ•°æ®è§£æ
4. **æ— æœç´¢å†å²** - æœªå®ç°æœç´¢å†å²è®°å½•åŠŸèƒ½
5. **æ— ç»“æœå±•ç¤º** - æœç´¢ç»“æœåˆ—è¡¨ Cell æœªå®šä¹‰

---

## äºŒã€åŠŸèƒ½éœ€æ±‚åˆ†æ

### 2.1 æ ¸å¿ƒåŠŸèƒ½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æœç´¢ç•Œé¢åŠŸèƒ½æ¶æ„                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. æœç´¢è¾“å…¥                                         â”‚
â”‚     â”œâ”€â”€ å®æ—¶æœç´¢ï¼ˆè¾“å…¥æ—¶å³æ—¶è¯·æ±‚ï¼‰                    â”‚
â”‚     â”œâ”€â”€ æœç´¢å»ºè®®ï¼ˆæ¨¡ç³ŠåŒ¹é…ï¼‰                         â”‚
â”‚     â””â”€â”€ é”®ç›˜æœç´¢ï¼ˆç‚¹å‡»æœç´¢æŒ‰é’®è§¦å‘ï¼‰                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  2. æœç´¢ç»“æœå±•ç¤º                                     â”‚
â”‚     â”œâ”€â”€ å•æ›²ç»“æœï¼ˆæ­Œæ›²å+æ­Œæ‰‹+ä¸“è¾‘å°é¢ï¼‰              â”‚
â”‚     â”œâ”€â”€ ä¸“è¾‘ç»“æœï¼ˆä¸“è¾‘å+æ­Œæ‰‹+å°é¢ï¼‰                  â”‚
â”‚     â””â”€â”€ æ­Œæ‰‹ç»“æœï¼ˆæ­Œæ‰‹å+å¤´åƒï¼‰                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  3. æœç´¢å†å²                                         â”‚
â”‚     â”œâ”€â”€ æœ¬åœ°å­˜å‚¨ï¼ˆä½¿ç”¨ NSUserDefaultsï¼‰               â”‚
â”‚     â”œâ”€â”€ å†å²è®°å½•å±•ç¤ºï¼ˆæ¨ªå‘æ ‡ç­¾æˆ–åˆ—è¡¨ï¼‰                â”‚
â”‚     â””â”€â”€ ä¸€é”®æ¸…é™¤åŠŸèƒ½                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  4. çƒ­é—¨æœç´¢                                         â”‚
â”‚     â”œâ”€â”€ ä»æœåŠ¡å™¨è·å–çƒ­é—¨å…³é”®è¯                        â”‚
â”‚     â””â”€â”€ ç‚¹å‡»ç›´æ¥æœç´¢                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  5. äº¤äº’åŠŸèƒ½                                         â”‚
â”‚     â”œâ”€â”€ ç‚¹å‡»æ­Œæ›² -> æ’­æ”¾                             â”‚
â”‚     â”œâ”€â”€ ç‚¹å‡»ä¸“è¾‘ -> è¿›å…¥ä¸“è¾‘è¯¦æƒ…é¡µ                    â”‚
â”‚     â””â”€â”€ ç‚¹å‡»æ­Œæ‰‹ -> è¿›å…¥æ­Œæ‰‹è¯¦æƒ…é¡µï¼ˆé¢„ç•™ï¼‰            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ç•Œé¢åŸå‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ” æœç´¢æ­Œæ›²ã€æ­Œæ‰‹ã€ä¸“è¾‘...      â”‚  â† UISearchBar
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æœç´¢å†å²                    âœ•  â”‚  â† æ ‡é¢˜ + æ¸…é™¤æŒ‰é’®
â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚å‘¨æ°ä¼¦â”‚ â”‚æ™´å¤© â”‚ â”‚å¤œæ›² â”‚ ...  â”‚  â† å†å²æ ‡ç­¾æ¨ªå‘æ»šåŠ¨
â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  çƒ­é—¨æœç´¢                        â”‚
â”‚  1. æ—ä¿Šæ° - å…³é”®è¯              â”‚
â”‚  2. é™ˆå¥•è¿… - åå¹´                â”‚  â† çƒ­é—¨åˆ—è¡¨
â”‚  3. è–›ä¹‹è°¦ - æ¼”å‘˜                â”‚
â”‚  ...                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ï¼ˆæœç´¢åå±•ç¤ºç»“æœï¼‰              â”‚
â”‚  â”Œâ”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚å°é¢â”‚ æ­Œæ›²å            â–¶   â”‚ â”‚  â† æœç´¢ç»“æœåˆ—è¡¨
â”‚  â”‚   â”‚ æ­Œæ‰‹ - ä¸“è¾‘             â”‚ â”‚
â”‚  â””â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚å°é¢â”‚ æ­Œæ›²å            â–¶   â”‚ â”‚
â”‚  â”‚   â”‚ æ­Œæ‰‹ - ä¸“è¾‘             â”‚ â”‚
â”‚  â””â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸‰ã€API æ¥å£è°ƒç ”

### 3.1 ç½‘æ˜“äº‘ API æœç´¢æ¥å£

**æœåŠ¡å™¨åŸºç¡€URL**: `https://1390963969-2g6ivueiij.ap-guangzhou.tencentscf.com`

#### 1. æœç´¢æ¥å£ - `/cloudsearch` (æ›´å®Œæ•´çš„æœç´¢ç»“æœ)

```
GET /cloudsearch
å‚æ•°ï¼š
  - keywords: æœç´¢å…³é”®è¯ï¼ˆå¿…å¡«ï¼‰
  - type: æœç´¢ç±»å‹ï¼ˆå¯é€‰ï¼Œé»˜è®¤1ï¼‰
    - 1: å•æ›²
    - 10: ä¸“è¾‘
    - 100: æ­Œæ‰‹
    - 1000: æ­Œå•
    - 1002: ç”¨æˆ·
    - 1004: MV
    - 1009: ç”µå°
    - 1014: è§†é¢‘
  - limit: è¿”å›æ•°é‡ï¼ˆé»˜è®¤30ï¼Œæœ€å¤§100ï¼‰
  - offset: åç§»é‡ï¼ˆé»˜è®¤0ï¼‰
```

**å“åº”å­—æ®µ**ï¼š
- `result.songs` - æ­Œæ›²åˆ—è¡¨
- `result.songCount` - æ­Œæ›²æ€»æ•°
- `result.albums` - ä¸“è¾‘åˆ—è¡¨ï¼ˆå½“ type=10ï¼‰
- `result.artistCount` - æ­Œæ‰‹æ•°é‡ï¼ˆå½“ type=100ï¼‰
- `result.playlistCount` - æ­Œå•æ•°é‡ï¼ˆå½“ type=1000ï¼‰
- `hasMore` - æ˜¯å¦æœ‰æ›´å¤šæ•°æ®

#### 2. æœç´¢å»ºè®®æ¥å£ - `/search/suggest`

```
GET /search/suggest
å‚æ•°ï¼š
  - keywords: æœç´¢å…³é”®è¯ï¼ˆå¿…å¡«ï¼‰
  - type: ç±»å‹ï¼ˆå¯é€‰ï¼Œé»˜è®¤'web'ï¼‰
    - 'mobile': è¿”å›æ›´ç®€åŒ–çš„ç»“æœ
```

**å“åº”å­—æ®µ**ï¼š
- `result.songs` - åŒ¹é…çš„æ­Œæ›²
- `result.artists` - åŒ¹é…çš„æ­Œæ‰‹
- `result.albums` - åŒ¹é…çš„ä¸“è¾‘
- `result.playlists` - åŒ¹é…çš„æ­Œå•

#### 3. çƒ­é—¨æœç´¢æ¥å£ - `/search/hot/detail`

```
GET /search/hot/detail
å‚æ•°ï¼šæ— 
```

**å“åº”å­—æ®µ**ï¼š
- `data[].searchWord` - æœç´¢è¯
- `data[].content` - æè¿°å†…å®¹
- `data[].score` - çƒ­åº¦åˆ†æ•°
- `data[].iconUrl` - å›¾æ ‡URL
- `data[].iconType` - å›¾æ ‡ç±»å‹ï¼ˆ0=æ— ï¼Œ1=çƒ­ï¼Œ2=æ–°ï¼‰

### 3.2 å“åº”æ•°æ®ç»“æ„

#### å•æ›²æœç´¢ç»“æœ (`/cloudsearch?type=1`)

```json
{
  "result": {
    "songs": [
      {
        "id": 2140776001,
        "name": "èœƒæ¥¼",
        "ar": [
          {"id": 1030001, "name": "å‘¨æ·±"}
        ],
        "al": {
          "id": 190605791,
          "name": "åæ·±ä»£è¯",
          "picUrl": "https://p2.music.126.net/xxx.jpg"
        },
        "dt": 226920,
        "mv": 14711872,
        "fee": 4,
        "pop": 100,
        "privilege": {
          "fee": 4,
          "payed": 0,
          "st": 0,
          "pl": 0,
          "dl": 0
        }
      }
    ],
    "songCount": 135,
    "hasMore": true
  },
  "code": 200
}
```

**ä¸ç°æœ‰ XC-YYSongData æ¨¡å‹çš„æ˜ å°„**ï¼š
| APIå­—æ®µ | æ¨¡å‹å±æ€§ | è¯´æ˜ |
|---------|----------|------|
| `id` | `songId` | æ­Œæ›²ID |
| `name` | `name` | æ­Œæ›²å |
| `al.picUrl` | `mainIma` | å°é¢å›¾ |
| `ar[0].name` | `artist` | æ­Œæ‰‹å |
| `ar[0].id` | `artistId` | æ­Œæ‰‹ID |
| `al.name` | `albumName` | ä¸“è¾‘å |
| `al.id` | `albumId` | ä¸“è¾‘ID |
| `dt` | `duration` | æ—¶é•¿(ms) |
| `mv` | `mvId` | MV ID |
| `fee` | `fee` | ä»˜è´¹ç±»å‹ |
| `pop` | `popularity` | çƒ­åº¦ |

#### çƒ­é—¨æœç´¢å“åº” (`/search/hot/detail`)

```json
{
  "data": [
    {
      "searchWord": "å‘¨æ°ä¼¦",
      "score": 9854321,
      "content": "åè¯­æµè¡Œå¤©ç‹",
      "source": 0,
      "iconType": 1,
      "iconUrl": "https://p1.music.126.net/xxx.png",
      "url": "",
      "alg": "alg_search_hot"
    },
    {
      "searchWord": "æ—ä¿Šæ°æ–°æ­Œ",
      "score": 8765432,
      "content": "è¡Œèµ°çš„CD",
      "iconType": 2
    }
  ],
  "code": 200
}
```

**iconType è¯´æ˜**ï¼š
- `0` - æ— å›¾æ ‡
- `1` - çƒ­ï¼ˆçº¢è‰²ç«ç„°å›¾æ ‡ï¼‰
- `2` - æ–°ï¼ˆç»¿è‰²NEWå›¾æ ‡ï¼‰
- `3` - ç‹¬å®¶
- `4` - æ¦œ

#### æœç´¢å»ºè®®å“åº” (`/search/suggest`)

```json
{
  "result": {
    "songs": [
      {"id": 123, "name": "æ™´å¤©", "artists": [{"name": "å‘¨æ°ä¼¦"}]}
    ],
    "artists": [
      {"id": 456, "name": "å‘¨æ°ä¼¦", "picUrl": "xxx.jpg"}
    ],
    "albums": [
      {"id": 789, "name": "å¶æƒ ç¾", "artist": {"name": "å‘¨æ°ä¼¦"}, "picUrl": "xxx.jpg"}
    ],
    "playlists": [
      {"id": 101, "name": "å‘¨æ°ä¼¦ç²¾é€‰", "creator": {"nickname": "æŸæŸ"}, "coverImgUrl": "xxx.jpg"}
    ]
  },
  "code": 200
}
```

---

## å››ã€å¼€å‘ä»»åŠ¡åˆ†è§£

### 4.1 ä»»åŠ¡æ¸…å•ï¼ˆåŸºäºç½‘æ˜“äº‘ APIï¼‰

| åºå· | ä»»åŠ¡ | ä¼˜å…ˆçº§ | é¢„è®¡å·¥æ—¶ | æ¶‰åŠæ–‡ä»¶ | API æ¥å£ |
|------|------|--------|----------|----------|----------|
| 1 | åˆ›å»ºçƒ­é—¨æœç´¢æ•°æ®æ¨¡å‹ | ğŸ”´ é«˜ | 0.5h | XCSearchResultData.h/m | `/search/hot/detail` |
| 2 | å®ç°æœç´¢ç½‘ç»œè¯·æ±‚æ–¹æ³• | ğŸ”´ é«˜ | 2h | XCNetworkManager.h/m | `/cloudsearch`, `/search/suggest` |
| 3 | å®Œå–„ XCSearchModel ä¸šåŠ¡é€»è¾‘ | ğŸ”´ é«˜ | 2h | XCSearchModel.h/m | - |
| 4 | åˆ›å»ºæœç´¢ç»“æœ Cell | ğŸ”´ é«˜ | 2h | XCSearchResultCell.h/m | - |
| 5 | å®Œå–„ XCSearchView UI å¸ƒå±€ | ğŸ”´ é«˜ | 2h | XCSearchView.h/m | - |
| 6 | å®Œå–„ XCSearchViewController | ğŸ”´ é«˜ | 3h | XCSearchViewController.h/m | - |
| 7 | å®ç°æœç´¢å†å²åŠŸèƒ½ | ğŸŸ¡ ä¸­ | 2h | XCSearchHistoryManager.h/m | NSUserDefaults |
| 8 | å®ç°çƒ­é—¨æœç´¢åŠŸèƒ½ï¼ˆå¸¦å›¾æ ‡ï¼‰ | ğŸŸ¡ ä¸­ | 1.5h | XCSearchViewController.m | `/search/hot/detail` |
| 9 | æœç´¢å»ºè®®åŠŸèƒ½ | ğŸŸ¡ ä¸­ | 1h | XCSearchModel.m | `/search/suggest` |
| 10 | æœç´¢é˜²æŠ–ä¼˜åŒ– | ğŸŸ¡ ä¸­ | 0.5h | XCSearchViewController.m | - |
| 11 | ç©ºçŠ¶æ€å’ŒåŠ è½½çŠ¶æ€ | ğŸŸ¡ ä¸­ | 1.5h | XCSearchView.m | - |
| 12 | æµ‹è¯•å’Œ Bug ä¿®å¤ | ğŸŸ¢ ä½ | 2h | å…¨éƒ¨ | - |

### 4.2 å¼€å‘é˜¶æ®µè§„åˆ’

```
ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€åŠŸèƒ½ï¼ˆé¢„è®¡ 12 å°æ—¶ï¼‰
â”œâ”€â”€ Day 1: æ•°æ®å±‚å¼€å‘
â”‚   â”œâ”€â”€ åˆ›å»º XCSearchResultData æ¨¡å‹
â”‚   â”œâ”€â”€ åœ¨ XCNetworkManager æ·»åŠ æœç´¢ API æ–¹æ³•
â”‚   â””â”€â”€ å®Œå–„ XCSearchModel ä¸šåŠ¡é€»è¾‘
â”‚
â”œâ”€â”€ Day 2: UI å±‚å¼€å‘
â”‚   â”œâ”€â”€ åˆ›å»º XCSearchResultCell
â”‚   â”œâ”€â”€ å®Œå–„ XCSearchView å¸ƒå±€
â”‚   â””â”€â”€ å®Œå–„ XCSearchViewController
â”‚
â””â”€â”€ Day 3: è”è°ƒæµ‹è¯•
    â”œâ”€â”€ æœç´¢åŠŸèƒ½è”è°ƒ
    â””â”€â”€ åŸºç¡€ Bug ä¿®å¤

ç¬¬äºŒé˜¶æ®µï¼šå¢å¼ºåŠŸèƒ½ï¼ˆé¢„è®¡ 6 å°æ—¶ï¼‰
â”œâ”€â”€ Day 4: æœç´¢å†å²
â”‚   â”œâ”€â”€ åˆ›å»º XCSearchHistoryManager
â”‚   â””â”€â”€ é›†æˆå†å²è®°å½• UI
â”‚
â”œâ”€â”€ Day 5: ä¼˜åŒ–å®Œå–„
â”‚   â”œâ”€â”€ çƒ­é—¨æœç´¢
â”‚   â”œâ”€â”€ é˜²æŠ–ä¼˜åŒ–
â”‚   â”œâ”€â”€ ç©ºçŠ¶æ€/åŠ è½½çŠ¶æ€
â”‚   â””â”€â”€ æœ€ç»ˆæµ‹è¯•
```

---

## äº”ã€è¯¦ç»†è®¾è®¡æ–¹æ¡ˆ

### 5.1 æ•°æ®å±‚è®¾è®¡

#### 5.1.1 æœç´¢ç»“æœæ•°æ®æ¨¡å‹ (XCSearchResultData.h)

```objc
#import <Foundation/Foundation.h>
#import <YYModel/YYModel.h>

NS_ASSUME_NONNULL_BEGIN

typedef NS_ENUM(NSInteger, XCSearchResultType) {
    XCSearchResultTypeSong = 1,       // å•æ›²
    XCSearchResultTypeAlbum = 10,     // ä¸“è¾‘
    XCSearchResultTypeArtist = 100,   // æ­Œæ‰‹
    XCSearchResultTypePlaylist = 1000 // æ­Œå•
};

#pragma mark - çƒ­é—¨æœç´¢é¡¹
@interface XCHotSearchItem : NSObject <YYModel>
@property (nonatomic, copy) NSString *searchWord;    // æœç´¢è¯
@property (nonatomic, assign) NSInteger score;       // çƒ­åº¦åˆ†æ•°
@property (nonatomic, copy) NSString *content;       // æè¿°å†…å®¹
@property (nonatomic, assign) NSInteger iconType;    // å›¾æ ‡ç±»å‹ 0=æ—  1=çƒ­ 2=æ–°
@property (nonatomic, copy) NSString *iconUrl;       // å›¾æ ‡URL
@end

#pragma mark - æœç´¢å»ºè®®
@interface XCSearchSuggest : NSObject <YYModel>
@property (nonatomic, strong) NSArray<XC_YYSongData *> *songs;      // å»ºè®®çš„æ­Œæ›²
@property (nonatomic, strong) NSArray *artists;      // å»ºè®®çš„æ­Œæ‰‹
@property (nonatomic, strong) NSArray *albums;       // å»ºè®®çš„ä¸“è¾‘
@property (nonatomic, strong) NSArray *playlists;    // å»ºè®®çš„æ­Œå•
@end

#pragma mark - é€šç”¨æœç´¢ç»“æœ
@interface XCSearchResultData : NSObject <YYModel>

#pragma mark - é€šç”¨å±æ€§
@property (nonatomic, assign) XCSearchResultType resultType;
@property (nonatomic, copy) NSString *resultId;
@property (nonatomic, copy) NSString *name;
@property (nonatomic, copy) NSString *imageUrl;

#pragma mark - å•æ›²ç‰¹æœ‰ (å¤ç”¨ XC-YYSongData ç»“æ„)
@property (nonatomic, strong) XC_YYSongData *songData;

#pragma mark - ä¸“è¾‘/æ­Œå•ç‰¹æœ‰
@property (nonatomic, copy) NSString *creatorName;
@property (nonatomic, assign) NSInteger trackCount;
@property (nonatomic, copy) NSString *descriptionText;

#pragma mark - æ­Œæ‰‹ç‰¹æœ‰
@property (nonatomic, assign) NSInteger albumSize;
@property (nonatomic, assign) NSInteger musicSize;

#pragma mark - å·¥å‚æ–¹æ³•
/// ä» XC-YYSongData åˆ›å»ºæœç´¢ç»“æœ
+ (instancetype)resultFromSongData:(XC_YYSongData *)songData;

@end

NS_ASSUME_NONNULL_END
```

#### 5.1.2 æœç´¢å†å²ç®¡ç†å™¨ (XCSearchHistoryManager.h)

```objc
#import <Foundation/Foundation.h>

NS_ASSUME_NONNULL_BEGIN

@interface XCSearchHistoryManager : NSObject

+ (instancetype)sharedInstance;

// è·å–æ‰€æœ‰å†å²è®°å½•
- (NSArray<NSString *> *)getAllHistory;

// æ·»åŠ æœç´¢è®°å½•
- (void)addSearchKeyword:(NSString *)keyword;

// åˆ é™¤å•æ¡è®°å½•
- (void)removeSearchKeyword:(NSString *)keyword;

// æ¸…ç©ºæ‰€æœ‰è®°å½•
- (void)clearAllHistory;

// æœ€å¤§è®°å½•æ•°ï¼ˆé»˜è®¤ 20ï¼‰
@property (nonatomic, assign) NSInteger maxHistoryCount;

@end

NS_ASSUME_NONNULL_END
```

#### 5.1.3 å®Œå–„ XCSearchModel

```objc
#import <Foundation/Foundation.h>
#import "XCSearchResultData.h"

NS_ASSUME_NONNULL_BEGIN

@interface XCSearchModel : NSObject

#pragma mark - æ•°æ®å±æ€§
@property (nonatomic, strong) NSMutableArray<XC_YYSongData *> *searchResults;  // å•æ›²æœç´¢ç»“æœ
@property (nonatomic, strong) NSMutableArray<XCHotSearchItem *> *hotSearchItems; // çƒ­é—¨æœç´¢åˆ—è¡¨
@property (nonatomic, strong) XCSearchSuggest *searchSuggest;  // æœç´¢å»ºè®®
@property (nonatomic, copy) NSString *currentKeyword;
@property (nonatomic, assign) BOOL isLoading;
@property (nonatomic, assign) NSInteger currentOffset;
@property (nonatomic, assign) NSInteger totalCount;
@property (nonatomic, assign) BOOL hasMore;
@property (nonatomic, assign) XCSearchResultType currentSearchType;

#pragma mark - æœç´¢æ–¹æ³•

/// æ‰§è¡Œå®Œæ•´æœç´¢ (ä½¿ç”¨ /cloudsearch)
- (void)searchWithKeyword:(NSString *)keyword
                     type:(XCSearchResultType)type
               completion:(void(^)(BOOL success, NSString * _Nullable errorMsg))completion;

/// åŠ è½½æ›´å¤šç»“æœ
- (void)loadMoreWithCompletion:(void(^)(BOOL success, NSString * _Nullable errorMsg))completion;

/// è·å–æœç´¢å»ºè®® (ç”¨äºå®æ—¶æç¤º)
- (void)fetchSearchSuggest:(NSString *)keyword
                completion:(void(^)(BOOL success))completion;

/// è·å–çƒ­é—¨æœç´¢è¯¦æƒ…
- (void)fetchHotSearchWithCompletion:(void(^)(BOOL success))completion;

/// è·å–é»˜è®¤æœç´¢å…³é”®è¯
- (void)fetchDefaultKeywordWithCompletion:(void(^)(NSString * _Nullable keyword))completion;

#pragma mark - è¾…åŠ©æ–¹æ³•

/// å°†æœç´¢ç»“æœè½¬ä¸ºæ’­æ”¾æ•°æ®
- (NSArray<XC_YYSongData *> *)getPlayableSongsFromResults;

/// æ¸…ç©ºæœç´¢ç»“æœ
- (void)clearSearchResults;

@end

NS_ASSUME_NONNULL_END
```

---

### 5.2 ç½‘ç»œå±‚æ‰©å±•

#### 5.2.1 XCNetworkManager æ–°å¢æ–¹æ³•

```objc
#pragma mark - æœç´¢ç›¸å…³æ¥å£

/// ä½¿ç”¨ /cloudsearch è¿›è¡Œå®Œæ•´æœç´¢
/// @param keyword æœç´¢å…³é”®è¯
/// @param type æœç´¢ç±»å‹ 1=å•æ›² 10=ä¸“è¾‘ 100=æ­Œæ‰‹ 1000=æ­Œå•
/// @param offset åç§»é‡
/// @param limit è¿”å›æ•°é‡ (æœ€å¤§100)
/// @param completion å›è°ƒ
- (void)cloudSearchWithKeyword:(NSString *)keyword
                          type:(NSInteger)type
                        offset:(NSInteger)offset
                         limit:(NSInteger)limit
                    completion:(void(^)(NSArray * _Nullable results, 
                                        NSInteger totalCount,
                                        BOOL hasMore, 
                                        NSError * _Nullable error))completion;

/// æœç´¢å»ºè®® (ç”¨äºå®æ—¶æç¤º)
/// @param keyword æœç´¢å…³é”®è¯
/// @param completion å›è°ƒ
- (void)searchSuggestWithKeyword:(NSString *)keyword
                      completion:(void(^)(NSDictionary * _Nullable suggestData,
                                          NSError * _Nullable error))completion;

/// è·å–çƒ­é—¨æœç´¢è¯¦æƒ…ï¼ˆå¸¦çƒ­åº¦ã€å›¾æ ‡ï¼‰
- (void)getHotSearchDetailWithCompletion:(void(^)(NSArray * _Nullable hotItems, 
                                                   NSError * _Nullable error))completion;

/// è·å–é»˜è®¤æœç´¢å…³é”®è¯ï¼ˆå±•ç¤ºåœ¨æœç´¢æ¡†ï¼‰
- (void)getDefaultSearchKeywordWithCompletion:(void(^)(NSString * _Nullable keyword,
                                                       NSString * _Nullable showText,
                                                       NSError * _Nullable error))completion;
```

### 5.3 UI å±‚è®¾è®¡

#### 5.3.1 æœç´¢ç»“æœ Cell (XCSearchResultCell)

```objc
#import <UIKit/UIKit.h>
#import "XCSearchResultData.h"

NS_ASSUME_NONNULL_BEGIN

@interface XCSearchResultCell : UITableViewCell

@property (nonatomic, strong) XCSearchResultData *data;
@property (nonatomic, strong) UIImageView *coverImageView;
@property (nonatomic, strong) UILabel *titleLabel;
@property (nonatomic, strong) UILabel *subtitleLabel;
@property (nonatomic, strong) UIButton *playButton;

- (void)configureWithData:(XCSearchResultData *)data;

@end

NS_ASSUME_NONNULL_END
```

**Cell å¸ƒå±€å‚è€ƒï¼š**
- å·¦ä¾§ï¼š50x50 åœ†è§’å°é¢å›¾ï¼ˆSDWebImage åŠ è½½ï¼‰
- ä¸­é—´ï¼šæ­Œæ›²åï¼ˆä¸»æ ‡é¢˜ï¼‰+ æ­Œæ‰‹ - ä¸“è¾‘ï¼ˆå‰¯æ ‡é¢˜ï¼‰
- å³ä¾§ï¼šæ’­æ”¾æŒ‰é’®ï¼ˆå•æ›²ï¼‰æˆ–ç®­å¤´ï¼ˆä¸“è¾‘/æ­Œæ‰‹ï¼‰

#### 5.3.2 XCSearchView å¸ƒå±€ç»“æ„

```objc
@interface XCSearchView : UIView

#pragma mark - ä¸»è¦è§†å›¾
@property (nonatomic, strong) UITableView *resultTableView;

#pragma mark - æœç´¢å†å²å’Œçƒ­é—¨æœç´¢è§†å›¾
@property (nonatomic, strong) UIView *historyContainerView;
@property (nonatomic, strong) UIScrollView *historyScrollView;
@property (nonatomic, strong) UIView *hotSearchContainerView;
@property (nonatomic, strong) UITableView *hotSearchTableView;

#pragma mark - ç©ºçŠ¶æ€å’ŒåŠ è½½è§†å›¾
@property (nonatomic, strong) UIView *emptyStateView;
@property (nonatomic, strong) UIActivityIndicatorView *loadingIndicator;
@property (nonatomic, strong) UILabel *emptyStateLabel;

#pragma mark - æ–¹æ³•
- (void)showHistoryView;
- (void)showHotSearchView;
- (void)showResultView;
- (void)showEmptyStateWithText:(NSString *)text;
- (void)showLoading;
- (void)hideLoading;

@end
```

#### 5.3.3 XCSearchViewController å®Œå–„

```objc
@interface XCSearchViewController : UIViewController <
    UISearchResultsUpdating, 
    UISearchBarDelegate,
    UITableViewDelegate, 
    UITableViewDataSource
>

@property (nonatomic, strong) XCSearchView *mainView;
@property (nonatomic, strong) XCSearchModel *model;
@property (nonatomic, strong) UISearchController *searchController;

// é˜²æŠ–å®šæ—¶å™¨
@property (nonatomic, strong) NSTimer *searchTimer;

@end
```

### 5.4 äº¤äº’æµç¨‹è®¾è®¡

```
ç”¨æˆ·è¾“å…¥å…³é”®è¯
     â”‚
     â–¼
è§¦å‘ updateSearchResultsForSearchController
     â”‚
     â–¼
å–æ¶ˆä¹‹å‰çš„å®šæ—¶å™¨ï¼ˆé˜²æŠ–ï¼‰
     â”‚
     â–¼
åˆ›å»ºæ–°çš„ 0.5s å®šæ—¶å™¨
     â”‚
     â–¼
å®šæ—¶å™¨è§¦å‘ -> æ‰§è¡Œæœç´¢è¯·æ±‚
     â”‚
     â–¼
XCNetworkManager å‘èµ·ç½‘ç»œè¯·æ±‚
     â”‚
     â–¼
è§£ææ•°æ® -> XCSearchResultData æ•°ç»„
     â”‚
     â–¼
æ›´æ–° XCSearchModel.searchResults
     â”‚
     â–¼
å‘é€é€šçŸ¥æˆ–ç›´æ¥åˆ·æ–° TableView
     â”‚
     â–¼
XCSearchView.resultTableView reloadData
     â”‚
     â–¼
å±•ç¤ºæœç´¢ç»“æœ
```

---

## å…­ã€å…³é”®ä»£ç å®ç°å‚è€ƒ

### 6.1 æœç´¢é˜²æŠ–å®ç°ï¼ˆä½¿ç”¨ /cloudsearchï¼‰

```objc
#pragma mark - UISearchResultsUpdating

- (void)updateSearchResultsForSearchController:(UISearchController *)searchController {
    NSString *searchText = searchController.searchBar.text;
    
    // å–æ¶ˆä¹‹å‰çš„å®šæ—¶å™¨
    [self.searchTimer invalidate];
    self.searchTimer = nil;
    
    // ç©ºå†…å®¹ä¸æœç´¢ï¼Œæ˜¾ç¤ºå†å²å’Œçƒ­é—¨
    if (searchText.length == 0) {
        [self.model clearSearchResults];
        [self.mainView.resultTableView reloadData];
        [self.mainView showHistoryView];
        return;
    }
    
    // åˆ›å»ºæ–°çš„å®šæ—¶å™¨ï¼Œ0.5ç§’åæ‰§è¡Œæœç´¢
    self.searchTimer = [NSTimer scheduledTimerWithTimeInterval:0.5
                                                        target:self
                                                      selector:@selector(performSearch:)
                                                      userInfo:@{@"keyword": searchText}
                                                       repeats:NO];
    
    // åŒæ—¶è·å–æœç´¢å»ºè®®ï¼ˆæ›´å¿«å“åº”ï¼‰
    [self.model fetchSearchSuggest:searchText completion:^(BOOL success) {
        if (success && self.model.searchSuggest.songs.count > 0) {
            // å¯ä»¥åœ¨è¿™é‡Œæ˜¾ç¤ºæœç´¢å»ºè®®ä¸‹æ‹‰æ¡†
        }
    }];
}

- (void)performSearch:(NSTimer *)timer {
    NSString *keyword = timer.userInfo[@"keyword"];
    
    [self.mainView showLoading];
    
    // ä½¿ç”¨ /cloudsearch è¿›è¡Œå®Œæ•´æœç´¢
    [self.model searchWithKeyword:keyword
                             type:XCSearchResultTypeSong
                       completion:^(BOOL success, NSString * _Nullable errorMsg) {
        dispatch_async(dispatch_get_main_queue(), ^{
            [self.mainView hideLoading];
            if (success) {
                [self.mainView showResultView];
                [self.mainView.resultTableView reloadData];
                // ä¿å­˜æœç´¢å†å²
                [[XCSearchHistoryManager sharedInstance] addSearchKeyword:keyword];
            } else {
                [self.mainView showEmptyStateWithText:errorMsg ?: @"æœç´¢å¤±è´¥ï¼Œè¯·é‡è¯•"];
            }
        });
    }];
}
```

### 6.2 æœç´¢å†å²æ ‡ç­¾å¸ƒå±€

```objc
- (void)setupHistoryTags:(NSArray<NSString *> *)historyKeywords {
    // æ¸…é™¤æ—§æ ‡ç­¾
    for (UIView *subview in self.historyScrollView.subviews) {
        [subview removeFromSuperview];
    }
    
    CGFloat xOffset = 16;
    CGFloat padding = 10;
    
    for (NSString *keyword in historyKeywords) {
        UIButton *tagBtn = [UIButton buttonWithType:UIButtonTypeRoundedRect];
        [tagBtn setTitle:keyword forState:UIControlStateNormal];
        [tagBtn addTarget:self action:@selector(historyTagTapped:) 
         forControlEvents:UIControlEventTouchUpInside];
        
        // è®¡ç®—å®½åº¦
        CGSize textSize = [keyword boundingRectWithSize:CGSizeMake(MAXFLOAT, 30)
                                                options:NSStringDrawingUsesLineFragmentOrigin
                                             attributes:@{NSFontAttributeName: [UIFont systemFontOfSize:14]}
                                                context:nil].size;
        CGFloat btnWidth = textSize.width + 20;
        
        tagBtn.frame = CGRectMake(xOffset, 5, btnWidth, 30);
        tagBtn.backgroundColor = [UIColor secondarySystemBackgroundColor];
        tagBtn.layer.cornerRadius = 15;
        
        [self.historyScrollView addSubview:tagBtn];
        xOffset += btnWidth + padding;
    }
    
    self.historyScrollView.contentSize = CGSizeMake(xOffset, 40);
}
```

### 6.3 æœç´¢ç»“æœ Cell å¸ƒå±€å®ç°

```objc
- (void)setupUI {
    // å°é¢å›¾
    self.coverImageView = [[UIImageView alloc] init];
    self.coverImageView.contentMode = UIViewContentModeScaleAspectFill;
    self.coverImageView.layer.cornerRadius = 4;
    self.coverImageView.clipsToBounds = YES;
    [self.contentView addSubview:self.coverImageView];
    
    // æ ‡é¢˜
    self.titleLabel = [[UILabel alloc] init];
    self.titleLabel.font = [UIFont systemFontOfSize:16 weight:UIFontWeightMedium];
    self.titleLabel.textColor = [UIColor labelColor];
    [self.contentView addSubview:self.titleLabel];
    
    // å‰¯æ ‡é¢˜
    self.subtitleLabel = [[UILabel alloc] init];
    self.subtitleLabel.font = [UIFont systemFontOfSize:13];
    self.subtitleLabel.textColor = [UIColor secondaryLabelColor];
    [self.contentView addSubview:self.subtitleLabel];
    
    // æ’­æ”¾æŒ‰é’®
    self.playButton = [UIButton buttonWithType:UIButtonTypeSystem];
    [self.playButton setImage:[UIImage systemImageNamed:@"play.fill"] forState:UIControlStateNormal];
    [self.contentView addSubview:self.playButton];
    
    // ä½¿ç”¨ Masonry å¸ƒå±€
    [self.coverImageView mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.equalTo(self.contentView).offset(16);
        make.centerY.equalTo(self.contentView);
        make.size.mas_equalTo(CGSizeMake(50, 50));
    }];
    
    [self.playButton mas_makeConstraints:^(MASConstraintMaker *make) {
        make.right.equalTo(self.contentView).offset(-16);
        make.centerY.equalTo(self.contentView);
        make.size.mas_equalTo(CGSizeMake(30, 30));
    }];
    
    [self.titleLabel mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.equalTo(self.coverImageView.mas_right).offset(12);
        make.right.equalTo(self.playButton.mas_left).offset(-8);
        make.top.equalTo(self.contentView).offset(12);
    }];
    
    [self.subtitleLabel mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.right.equalTo(self.titleLabel);
        make.top.equalTo(self.titleLabel.mas_bottom).offset(4);
    }];
}

- (void)configureWithData:(XCSearchResultData *)data {
    self.data = data;
    
    // è®¾ç½®æ ‡é¢˜
    self.titleLabel.text = data.name;
    
    // æ ¹æ®ç±»å‹è®¾ç½®å‰¯æ ‡é¢˜
    if (data.resultType == XCSearchResultTypeSong) {
        self.subtitleLabel.text = [NSString stringWithFormat:@"%@ - %@", 
                                   data.artistName, data.albumName];
        self.playButton.hidden = NO;
    } else if (data.resultType == XCSearchResultTypeAlbum) {
        self.subtitleLabel.text = [NSString stringWithFormat:@"ä¸“è¾‘ Â· %@", 
                                   data.creatorName];
        self.playButton.hidden = YES;
    }
    
    // åŠ è½½å›¾ç‰‡
    [self.coverImageView sd_setImageWithURL:[NSURL URLWithString:data.imageUrl]
                           placeholderImage:[UIImage systemImageNamed:@"music.note"]];
}
```

---

## ä¸ƒã€é¡¹ç›®æ–‡ä»¶å˜æ›´æ¸…å•

### 7.1 æ–°å¢æ–‡ä»¶

```
Spotify - clone/
â”œâ”€â”€ æ•°æ®ç»“æ„/
â”‚   â””â”€â”€ XCSearchResultData.h/m          # æœç´¢ç»“æœæ•°æ®æ¨¡å‹ï¼ˆæ–°å»ºï¼‰
â”‚
â”œâ”€â”€ 5. TabBaré™„åŠ è§†å›¾ï¼Œæœç´¢éƒ¨åˆ†/
â”‚   â””â”€â”€ 2. æœç´¢/
â”‚       â”œâ”€â”€ XCSearchHistoryManager.h/m   # æœç´¢å†å²ç®¡ç†å™¨ï¼ˆæ–°å»ºï¼‰
â”‚       â””â”€â”€ cells/
â”‚           â””â”€â”€ XCSearchResultCell.h/m   # æœç´¢ç»“æœ Cellï¼ˆæ–°å»ºï¼‰
```

### 7.2 ä¿®æ”¹æ–‡ä»¶

```
Spotify - clone/
â”œâ”€â”€ 6. ç½‘ç»œè¯·æ±‚éƒ¨åˆ†/
â”‚   â”œâ”€â”€ XCNetworkManager.h              # æ·»åŠ æœç´¢ API å£°æ˜
â”‚   â””â”€â”€ XCNetworkManager.m              # å®ç°æœç´¢ç½‘ç»œè¯·æ±‚
â”‚
â””â”€â”€ 5. TabBaré™„åŠ è§†å›¾ï¼Œæœç´¢éƒ¨åˆ†/
    â””â”€â”€ 2. æœç´¢/
        â”œâ”€â”€ XCSearchModel.h/m           # å®Œå–„ä¸šåŠ¡é€»è¾‘
        â”œâ”€â”€ XCSearchView.h/m            # å®Œå–„ UI å¸ƒå±€
        â””â”€â”€ XCSearchViewController.h/m  # å®Œå–„æ§åˆ¶å™¨é€»è¾‘
```

---

## å…«ã€ä¾èµ–åº“æ£€æŸ¥

ç¡®è®¤ä»¥ä¸‹ä¾èµ–å·²åœ¨ Podfile ä¸­ï¼š

```ruby
# å·²æœ‰ä¾èµ–ï¼ˆç¡®ä¿å¯ç”¨ï¼‰
pod 'AFNetworking', '~> 4.0.1'      # ç½‘ç»œè¯·æ±‚
pod 'YYModel', '~> 1.0.4'           # JSON è§£æ
pod 'SDWebImage', '~> 5.21.3'       # å›¾ç‰‡åŠ è½½
pod 'Masonry', '~> 1.1.0'           # å¸ƒå±€
```

---

## ä¹ã€æµ‹è¯•è®¡åˆ’

### 9.1 åŠŸèƒ½æµ‹è¯•ç”¨ä¾‹

| æµ‹è¯•é¡¹ | æµ‹è¯•æ­¥éª¤ | é¢„æœŸç»“æœ | API |
|--------|----------|----------|-----|
| æœç´¢è¾“å…¥ | åœ¨æœç´¢æ¡†è¾“å…¥"å‘¨æ°ä¼¦" | 0.5ç§’åæ˜¾ç¤ºæœç´¢ç»“æœ | `/cloudsearch` |
| é˜²æŠ–åŠŸèƒ½ | å¿«é€Ÿè¾“å…¥"å‘¨æ°"ç„¶åç«‹å³åˆ é™¤ | ä¸è§¦å‘æœç´¢è¯·æ±‚ | - |
| æœç´¢å»ºè®® | è¾“å…¥"æ™´å¤©" | æ˜¾ç¤ºä¸‹æ‹‰å»ºè®® | `/search/suggest` |
| ç»“æœå±•ç¤º | æœç´¢"æ™´å¤©" | æ˜¾ç¤ºæ­Œæ›²åˆ—è¡¨ï¼ŒåŒ…å«å°é¢ã€æ­Œåã€æ­Œæ‰‹ | `/cloudsearch` |
| ç‚¹å‡»æ’­æ”¾ | ç‚¹å‡»æœç´¢ç»“æœä¸­çš„æ­Œæ›² | å¼€å§‹æ’­æ”¾è¯¥æ­Œæ›²ï¼ˆå¤ç”¨ç°æœ‰æ’­æ”¾å™¨ï¼‰ | - |
| çƒ­é—¨æœç´¢ | è¿›å…¥æœç´¢é¡µé¢ | æ˜¾ç¤ºå¸¦å›¾æ ‡çš„çƒ­é—¨æœç´¢ | `/search/hot/detail` |
| çƒ­é—¨ç‚¹å‡» | ç‚¹å‡»çƒ­é—¨"å‘¨æ°ä¼¦" | è‡ªåŠ¨å¡«å……å¹¶æœç´¢ | - |
| å†å²è®°å½• | æœç´¢"ä¸ƒé‡Œé¦™"åè¿”å› | å†å²è®°å½•æ˜¾ç¤º"ä¸ƒé‡Œé¦™" | NSUserDefaults |
| æ¸…ç©ºå†å² | ç‚¹å‡»æ¸…é™¤æŒ‰é’® | å†å²è®°å½•ä¸ºç©º | - |
| å†å²ç‚¹å‡» | ç‚¹å‡»å†å²æ ‡ç­¾ | è‡ªåŠ¨å¡«å……å¹¶æœç´¢ | - |
| ç©ºçŠ¶æ€ | æœç´¢ä¹±ç "xyz123abc" | æ˜¾ç¤º"æ— æœç´¢ç»“æœ" | `/cloudsearch` |
| åŠ è½½çŠ¶æ€ | æœç´¢æ—¶è§‚å¯Ÿ UI | æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨ | - |
| åŠ è½½æ›´å¤š | æ»‘åŠ¨åˆ°åº•éƒ¨ | åŠ è½½æ›´å¤šç»“æœ | `/cloudsearch` |
| ä»˜è´¹æ ‡è¯† | æœç´¢ VIP æ­Œæ›² | æ˜¾ç¤ºä»˜è´¹/VIP æ ‡è¯† | `/cloudsearch` (feeå­—æ®µ) |

### 9.2 API æµ‹è¯•éªŒè¯

| æ¥å£ | æµ‹è¯•å‚æ•° | æœŸæœ›å“åº” |
|------|----------|----------|
| `/cloudsearch?keywords=å‘¨æ°ä¼¦&type=1&limit=30` | keywords=å‘¨æ°ä¼¦ | è¿”å›å‘¨æ°ä¼¦ç›¸å…³æ­Œæ›² |
| `/cloudsearch?keywords=æµ‹è¯•&type=10` | type=10 | è¿”å›ä¸“è¾‘åˆ—è¡¨ |
| `/search/suggest?keywords=å‘¨&type=mobile` | keywords=å‘¨ | è¿”å›å»ºè®®åˆ—è¡¨ |
| `/search/hot/detail` | æ—  | è¿”å›å¸¦ score/iconType çš„çƒ­é—¨åˆ—è¡¨ |
| `/search/default` | æ—  | è¿”å›é»˜è®¤æœç´¢å…³é”®è¯ |

### 9.3 æ€§èƒ½æµ‹è¯•

- `/search/suggest` å“åº”æ—¶é—´ < 300ms
- `/cloudsearch` å“åº”æ—¶é—´ < 1s
- å›¾ç‰‡åŠ è½½æµç•…æ— å¡é¡¿ï¼ˆSDWebImageï¼‰
- åˆ—è¡¨æ»‘åŠ¨ 60fps
- å†…å­˜å ç”¨ç¨³å®šï¼Œæ— æ³„æ¼

---

## åã€é£é™©è¯„ä¼°

| é£é™© | å¯èƒ½æ€§ | å½±å“ | åº”å¯¹æªæ–½ |
|------|--------|------|----------|
| ç½‘æ˜“äº‘ API ä¸ç¨³å®š | ä¸­ | é«˜ | å®ç°é‡è¯•æœºåˆ¶å’Œé”™è¯¯æç¤º |
| æœç´¢ç»“æœä¸ºç©º | ä½ | ä¸­ | å®Œå–„ç©ºçŠ¶æ€ UI |
| æœç´¢å†å²å­˜å‚¨è¿‡å¤š | ä½ | ä½ | é™åˆ¶æœ€å¤§å­˜å‚¨æ•°é‡ |
| å¿«é€Ÿè¾“å…¥å¯¼è‡´è¯·æ±‚å †ç§¯ | ä¸­ | ä¸­ | é˜²æŠ–å¤„ç† + è¯·æ±‚å–æ¶ˆ |
| å›¾ç‰‡åŠ è½½æ…¢å¯¼è‡´å¡é¡¿ | ä½ | ä¸­ | SDWebImage å¼‚æ­¥åŠ è½½ + å ä½å›¾ |

---

## åä¸€ã€å®Œæˆæ ‡å‡†

- [ ] æœç´¢åŠŸèƒ½å¯æ­£å¸¸ä½¿ç”¨ï¼Œè¾“å…¥å…³é”®è¯åå±•ç¤ºç»“æœ
- [ ] ç‚¹å‡»æœç´¢ç»“æœå¯æ’­æ”¾æ­Œæ›²æˆ–è¿›å…¥ä¸“è¾‘è¯¦æƒ…
- [ ] æœç´¢å†å²åŠŸèƒ½æ­£å¸¸ï¼Œå¯è®°å½•ã€å±•ç¤ºã€æ¸…é™¤å†å²
- [ ] çƒ­é—¨æœç´¢åŠŸèƒ½æ­£å¸¸ï¼Œç‚¹å‡»å¯ç›´æ¥æœç´¢
- [ ] UI ä¸ç°æœ‰ App é£æ ¼ä¸€è‡´ï¼Œä½¿ç”¨ Masonry å¸ƒå±€
- [ ] ä»£ç ç¬¦åˆé¡¹ç›®è§„èŒƒï¼Œæœ‰é€‚å½“çš„ä¸­æ–‡æ³¨é‡Š
- [ ] æ— æ˜æ˜¾ Bug å’Œå´©æºƒé—®é¢˜
- [ ] æœç´¢é˜²æŠ–ä¼˜åŒ–ç”Ÿæ•ˆ

---

## åäºŒã€é™„å½•

### 12.1 ç°æœ‰é¡¹ç›®å‚è€ƒä»£ç 

**ç½‘ç»œè¯·æ±‚ç¤ºä¾‹ï¼ˆå‚è€ƒ XCNetworkManagerï¼‰ï¼š**
```objc
NSString *baseUrl = @"https://1390963969-2g6ivueiij.ap-guangzhou.tencentscf.com";
AFHTTPSessionManager *manager = [AFHTTPSessionManager manager];
manager.responseSerializer.acceptableContentTypes = 
    [NSSet setWithObjects:@"application/json", @"text/json", 
                        @"text/javascript", @"text/html", @"text/plain", nil];

[manager GET:requestUrl
  parameters:params
     headers:nil
    progress:nil
     success:^(NSURLSessionDataTask * _Nonnull task, id _Nullable responseObject) {
    // è§£ææ•°æ® - ä½¿ç”¨ YYModel
} failure:^(NSURLSessionDataTask * _Nullable task, NSError * _Nonnull error) {
    // å¤„ç†é”™è¯¯
}];
```

**YYModel è§£æç¤ºä¾‹ï¼š**
```objc
// è§£æå•æ›²æ•°ç»„ - å¤ç”¨ç°æœ‰çš„ XC-YYSongData
NSArray *songsJSON = responseObject[@"result"][@"songs"];
NSArray<XC_YYSongData *> *songs = 
    [NSArray yy_modelArrayWithClass:[XC_YYSongData class] json:songsJSON];

// è§£æçƒ­é—¨æœç´¢
NSArray *hotJSON = responseObject[@"data"];
NSArray<XCHotSearchItem *> *hotItems = 
    [NSArray yy_modelArrayWithClass:[XCHotSearchItem class] json:hotJSON];
```

**SDWebImage åŠ è½½å›¾ç‰‡ç¤ºä¾‹ï¼š**
```objc
[imageView sd_setImageWithURL:[NSURL URLWithString:imageUrl]
             placeholderImage:[UIImage systemImageNamed:@"music.note"]];
```

### 12.2 ç½‘æ˜“äº‘ API å‚è€ƒèµ„æ–™ï¼ˆå·²éƒ¨ç½²æœåŠ¡å™¨ï¼‰

**æœåŠ¡å™¨åœ°å€**: `https://1390963969-2g6ivueiij.ap-guangzhou.tencentscf.com`

| æ¥å£ | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| å®Œæ•´æœç´¢ | `/cloudsearch` | æ”¯æŒå•æ›²/ä¸“è¾‘/æ­Œæ‰‹/æ­Œå•ï¼Œæ•°æ®å®Œæ•´ |
| æœç´¢å»ºè®® | `/search/suggest` | ç”¨äºå®æ—¶æç¤ºï¼Œå“åº”å¿« |
| çƒ­é—¨æœç´¢ | `/search/hot/detail` | å¸¦çƒ­åº¦ã€å›¾æ ‡çš„çƒ­é—¨æœç´¢ |
| é»˜è®¤å…³é”®è¯ | `/search/default` | æœç´¢æ¡†å ä½æ–‡å­— |

**å¸¸ç”¨ type å‚æ•°**ï¼š
- `1` - å•æ›²
- `10` - ä¸“è¾‘
- `100` - æ­Œæ‰‹
- `1000` - æ­Œå•
- `1002` - ç”¨æˆ·
- `1004` - MV
- `1014` - è§†é¢‘

### 12.3 å¤ç”¨ç°æœ‰æ•°æ®ç»“æ„è¯´æ˜

**é‡è¦**ï¼šç½‘æ˜“äº‘ `/cloudsearch` æ¥å£è¿”å›çš„å•æ›²æ•°æ®ç»“æ„ä¸é¡¹ç›®ä¸­å·²æœ‰çš„ `XC-YYSongData` å®Œå…¨ä¸€è‡´ï¼

```
API å­—æ®µ -> XC-YYSongData å±æ€§
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
id          -> songId
name        -> name
ar[]        -> artists
ar[0].name  -> artist
al.picUrl   -> mainIma
dt          -> duration
mv          -> mvId
fee         -> fee
pop         -> popularity
```

**ä¼˜åŠ¿**ï¼š
- æ— éœ€åˆ›å»ºæ–°çš„æ­Œæ›²æ¨¡å‹
- æœç´¢ç»“æœçš„æ­Œæ›²å¯ç›´æ¥ç”¨äºæ’­æ”¾
- ç‚¹å‡»æœç´¢ç»“æœå³å¯ç›´æ¥è°ƒç”¨æ’­æ”¾å™¨

### 12.4 UI è®¾è®¡è§„èŒƒ

| å…ƒç´  | è§„æ ¼ |
|------|------|
| èƒŒæ™¯è‰² | `[UIColor systemBackgroundColor]` |
| ä¸»æ–‡å­—é¢œè‰² | `[UIColor labelColor]` |
| å‰¯æ–‡å­—é¢œè‰² | `[UIColor secondaryLabelColor]` |
| ä¸»é¢˜è‰² | `[UIColor systemGreenColor]` |
| Cell é«˜åº¦ | 70pt |
| å°é¢å›¾å°ºå¯¸ | 50x50ptï¼Œåœ†è§’ 4pt |
| æ ‡é¢˜å­—ä½“ | System 16pt Medium |
| å‰¯æ ‡é¢˜å­—ä½“ | System 13pt Regular |
| çƒ­é—¨æ ‡ç­¾å›¾æ ‡ | 16x16pt |

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¶é—´**: 2026-02-08  
**æœ€åæ›´æ–°**: 2026-02-08

---

> ğŸ’¡ **æç¤º**ï¼šæœ¬è®¡åˆ’æŒ‰ç…§ MVVM æ¶æ„è®¾è®¡ï¼Œä¸ç°æœ‰é¡¹ç›®é£æ ¼ä¿æŒä¸€è‡´ã€‚å»ºè®®æŒ‰é˜¶æ®µè¿›è¡Œå¼€å‘ï¼Œæ¯å®Œæˆä¸€ä¸ªé˜¶æ®µåè¿›è¡Œæµ‹è¯•éªŒè¯ã€‚

---

## åä¸‰ã€XCNetworkManager æœç´¢æ¥å£å®ç°ç¤ºä¾‹

### 13.1 å®Œæ•´æœç´¢ (/cloudsearch)

```objc
#pragma mark - æœç´¢ç›¸å…³æ¥å£

- (void)cloudSearchWithKeyword:(NSString *)keyword
                          type:(NSInteger)type
                        offset:(NSInteger)offset
                         limit:(NSInteger)limit
                    completion:(void(^)(NSArray * _Nullable results, 
                                        NSInteger totalCount,
                                        BOOL hasMore, 
                                        NSError * _Nullable error))completion {
    NSString *baseUrl = @"https://1390963969-2g6ivueiij.ap-guangzhou.tencentscf.com";
    NSString *requestUrl = [NSString stringWithFormat:@"%@/cloudsearch", baseUrl];
    
    NSDictionary *params = @{
        @"keywords": keyword,
        @"type": @(type),
        @"offset": @(offset),
        @"limit": @(limit)
    };
    
    AFHTTPSessionManager *manager = [AFHTTPSessionManager manager];
    manager.responseSerializer.acceptableContentTypes = 
        [NSSet setWithObjects:@"application/json", @"text/json", 
                            @"text/javascript", @"text/html", @"text/plain", nil];
    
    [manager GET:requestUrl
      parameters:params
         headers:nil
        progress:nil
         success:^(NSURLSessionDataTask * _Nonnull task, id _Nullable responseObject) {
        if (![responseObject isKindOfClass:[NSDictionary class]]) {
            if (completion) completion(nil, 0, NO, nil);
            return;
        }
        
        NSDictionary *result = responseObject[@"result"];
        BOOL hasMore = [result[@"hasMore"] boolValue];
        NSArray *resultsArray = nil;
        NSInteger totalCount = 0;
        
        // æ ¹æ®ç±»å‹è§£æä¸åŒå­—æ®µ
        if (type == 1) { // å•æ›²
            resultsArray = result[@"songs"];
            totalCount = [result[@"songCount"] integerValue];
        } else if (type == 10) { // ä¸“è¾‘
            resultsArray = result[@"albums"];
            totalCount = [result[@"albumCount"] integerValue];
        } else if (type == 100) { // æ­Œæ‰‹
            resultsArray = result[@"artists"];
            totalCount = [result[@"artistCount"] integerValue];
        } else if (type == 1000) { // æ­Œå•
            resultsArray = result[@"playlists"];
            totalCount = [result[@"playlistCount"] integerValue];
        }
        
        if (completion) completion(resultsArray, totalCount, hasMore, nil);
        
    } failure:^(NSURLSessionDataTask * _Nullable task, NSError * _Nonnull error) {
        NSLog(@"æœç´¢è¯·æ±‚å¤±è´¥: %@", error);
        if (completion) completion(nil, 0, NO, error);
    }];
}
```

### 13.2 æœç´¢å»ºè®® (/search/suggest)

```objc
- (void)searchSuggestWithKeyword:(NSString *)keyword
                      completion:(void(^)(NSDictionary * _Nullable suggestData,
                                          NSError * _Nullable error))completion {
    NSString *baseUrl = @"https://1390963969-2g6ivueiij.ap-guangzhou.tencentscf.com";
    NSString *requestUrl = [NSString stringWithFormat:@"%@/search/suggest", baseUrl];
    
    NSDictionary *params = @{
        @"keywords": keyword,
        @"type": @"mobile"
    };
    
    AFHTTPSessionManager *manager = [AFHTTPSessionManager manager];
    manager.responseSerializer.acceptableContentTypes = 
        [NSSet setWithObjects:@"application/json", @"text/json", 
                            @"text/javascript", @"text/html", @"text/plain", nil];
    
    [manager GET:requestUrl
      parameters:params
         headers:nil
        progress:nil
         success:^(NSURLSessionDataTask * _Nonnull task, id _Nullable responseObject) {
        if ([responseObject isKindOfClass:[NSDictionary class]]) {
            NSDictionary *result = responseObject[@"result"];
            if (completion) completion(result, nil);
        } else {
            if (completion) completion(nil, nil);
        }
    } failure:^(NSURLSessionDataTask * _Nullable task, NSError * _Nonnull error) {
        NSLog(@"æœç´¢å»ºè®®è¯·æ±‚å¤±è´¥: %@", error);
        if (completion) completion(nil, error);
    }];
}
```

### 13.3 çƒ­é—¨æœç´¢ (/search/hot/detail)

```objc
- (void)getHotSearchDetailWithCompletion:(void(^)(NSArray * _Nullable hotItems, 
                                                   NSError * _Nullable error))completion {
    NSString *baseUrl = @"https://1390963969-2g6ivueiij.ap-guangzhou.tencentscf.com";
    NSString *requestUrl = [NSString stringWithFormat:@"%@/search/hot/detail", baseUrl];
    
    AFHTTPSessionManager *manager = [AFHTTPSessionManager manager];
    manager.responseSerializer.acceptableContentTypes = 
        [NSSet setWithObjects:@"application/json", @"text/json", 
                            @"text/javascript", @"text/html", @"text/plain", nil];
    
    [manager GET:requestUrl
      parameters:nil
         headers:nil
        progress:nil
         success:^(NSURLSessionDataTask * _Nonnull task, id _Nullable responseObject) {
        if ([responseObject isKindOfClass:[NSDictionary class]]) {
            NSArray *data = responseObject[@"data"];
            if (completion) completion(data, nil);
        } else {
            if (completion) completion(nil, nil);
        }
    } failure:^(NSURLSessionDataTask * _Nullable task, NSError * _Nonnull error) {
        NSLog(@"çƒ­é—¨æœç´¢è¯·æ±‚å¤±è´¥: %@", error);
        if (completion) completion(nil, error);
    }];
}
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.1  
**æ›´æ–°æ—¶é—´**: 2026-02-08  
**æ›´æ–°è¯´æ˜**: æ ¹æ®å®é™…ç½‘æ˜“äº‘ API æ¥å£ä¿®æ­£ï¼Œä½¿ç”¨ `/cloudsearch`ã€`/search/suggest`ã€`/search/hot/detail` æ¥å£

