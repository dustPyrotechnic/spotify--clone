# 项目数据结构定义

> 整理日期: 2026-02-07  
> 用途: 定义 APP 中与网易云 API 对应的数据模型

---

## 一、歌曲数据结构

### XC-YYSongData

对应 `/album` 接口返回的 `songs` 数组中的单个对象

```objc
@interface XC_YYSongData : NSObject <YYModel>

// MARK: - 基础信息
@property (nonatomic, copy) NSString *name;           // 歌曲名 (JSON: name)
@property (nonatomic, copy) NSString *songId;         // 歌曲ID (JSON: id)
@property (nonatomic, copy) NSString *songUrl;        // 播放URL (非API返回，需单独获取)

// MARK: - 艺术家信息
@property (nonatomic, copy) NSString *artist;         // 主艺术家名 (JSON: ar[0].name)
@property (nonatomic, copy) NSString *artistId;       // 主艺术家ID (JSON: ar[0].id)
@property (nonatomic, strong) NSArray *artists;       // 所有艺术家 (JSON: ar)

// MARK: - 专辑信息
@property (nonatomic, copy) NSString *mainIma;        // 专辑封面URL (JSON: al.picUrl)
@property (nonatomic, copy) NSString *albumName;      // 专辑名称 (JSON: al.name)
@property (nonatomic, copy) NSString *albumId;        // 专辑ID (JSON: al.id)

// MARK: - 播放信息
@property (nonatomic, assign) NSInteger duration;     // 时长，单位毫秒 (JSON: dt)
@property (nonatomic, assign) NSInteger trackNumber;  // 专辑内序号 (JSON: no)
@property (nonatomic, assign) NSInteger mvId;         // MV ID，0表示无 (JSON: mv)

// MARK: - 其他信息
@property (nonatomic, strong) NSArray *alias;         // 歌曲别名/副标题 (JSON: alia)
@property (nonatomic, assign) NSInteger popularity;   // 热度 0-100 (JSON: pop)
@property (nonatomic, assign) NSInteger fee;          // 付费类型 (JSON: fee)

// MARK: - 计算属性
@property (nonatomic, copy, readonly) NSString *durationText;  // 格式化时长 "03:46"

@end
```

### 字段映射关系

| 属性名 | JSON 路径 | 说明 |
|--------|----------|------|
| `name` | `name` | 歌曲名称 |
| `songId` | `id` | 歌曲唯一标识 |
| `artist` | `ar[0].name` | 首个歌手名（主唱）|
| `artistId` | `ar[0].id` | 首个歌手ID |
| `artists` | `ar` | 完整歌手数组（含id+name）|
| `mainIma` | `al.picUrl` | 专辑封面图 |
| `albumName` | `al.name` | 所属专辑名 |
| `albumId` | `al.id` | 所属专辑ID |
| `duration` | `dt` | 歌曲时长（毫秒）|
| `trackNumber` | `no` | 专辑中的第几首 |
| `mvId` | `mv` | MV编号，>0表示有MV |
| `alias` | `alia` | 别名数组（如"Live版"）|
| `popularity` | `pop` | 热度值 |
| `fee` | `fee` | 付费类型：0=免费，1=VIP，4=付费 |

### 示例数据

```json
{
  "name": "蜃楼",
  "id": 2140776001,
  "ar": [{"id": 1030001, "name": "周深"}],
  "al": {
    "id": 190605791,
    "name": "反深代词",
    "picUrl": "https://p2.music.126.net/xxx.jpg"
  },
  "dt": 226920,
  "mv": 14711872,
  "no": 2,
  "alia": [],
  "pop": 100,
  "fee": 4
}
```

转换为对象后：

```objc
song.name = @"蜃楼";
song.songId = @"2140776001";
song.artist = @"周深";
song.artistId = @"1030001";
song.mainIma = @"https://p2.music.126.net/xxx.jpg";
song.albumName = @"反深代词";
song.duration = 226920;  // 3分46秒
song.durationText = @"03:46";
song.trackNumber = 2;  // 专辑第2首
song.mvId = 14711872;  // 有MV
song.popularity = 100;
song.fee = 4;  // 付费歌曲
```

---

## 二、专辑数据结构

### XC-YYAlbumData

对应 `/top/playlist` 和 `/album/list` 接口返回的专辑/歌单对象

#### 歌单类型（/top/playlist）

```objc
@interface XC_YYAlbumData : NSObject <YYModel>

// MARK: - 基础信息
@property (nonatomic, copy) NSString *name;           // 歌单名 (JSON: name)
@property (nonatomic, copy) NSString *albumId;        // 歌单ID (JSON: id)
@property (nonatomic, copy) NSString *description;    // 歌单描述 (JSON: description)

// MARK: - 封面
@property (nonatomic, copy) NSString *coverImageUrl;  // 封面URL (JSON: coverImgUrl)

// MARK: - 统计信息
@property (nonatomic, assign) NSInteger trackCount;   // 歌曲数量 (JSON: trackCount)
@property (nonatomic, assign) NSInteger playCount;    // 播放次数 (JSON: playCount)
@property (nonatomic, assign) NSInteger subscribeCount; // 收藏数 (JSON: subscribedCount)

// MARK: - 作者信息
@property (nonatomic, copy) NSString *artistName;     // 创建者昵称 (JSON: creator.nickname)
@property (nonatomic, copy) NSString *userId;         // 创建者ID (JSON: creator.userId)
@property (nonatomic, copy) NSString *creatorAvatarUrl; // 创建者头像 (JSON: creator.avatarUrl)

// MARK: - 分类
@property (nonatomic, strong) NSArray *tags;          // 标签数组 (JSON: tags)

// MARK: - 状态
@property (nonatomic, assign) BOOL isHighQuality;     // 是否精品歌单 (JSON: highQuality)
@property (nonatomic, assign) BOOL isOrdered;         // 是否有序 (JSON: ordered)

@end
```

#### 数字专辑类型（/album/list）

```objc
@interface XC_YYAlbumData (Product)

// MARK: - 基础信息
@property (nonatomic, copy) NSString *albumName;      // 专辑名 (JSON: albumName)
@property (nonatomic, copy) NSString *albumId;        // 专辑ID (JSON: albumId)
@property (nonatomic, copy) NSString *artistName;     // 艺术家名 (JSON: artistName)

// MARK: - 封面
@property (nonatomic, copy) NSString *coverUrl;       // 封面URL (JSON: coverUrl)

// MARK: - 销售信息
@property (nonatomic, assign) NSInteger price;        // 价格/元 (JSON: price)
@property (nonatomic, assign) NSInteger saleNum;      // 销量 (JSON: saleNum)
@property (nonatomic, assign) long long pubTime;      // 发布时间戳 (JSON: pubTime)

// MARK: - 标识
@property (nonatomic, assign) BOOL isNewAlbum;        // 是否新专辑 (JSON: newAlbum)
@property (nonatomic, assign) NSInteger albumType;    // 专辑类型 (JSON: albumType)
@property (nonatomic, assign) NSInteger area;         // 地区 (JSON: area)

@end
```

### 字段映射关系

#### 歌单字段映射

| 属性名 | JSON 路径 | 说明 |
|--------|----------|------|
| `name` | `name` | 歌单名称 |
| `albumId` | `id` | 歌单ID |
| `coverImageUrl` | `coverImgUrl` | 封面图 |
| `trackCount` | `trackCount` | 包含歌曲数 |
| `playCount` | `playCount` | 播放量 |
| `subscribeCount` | `subscribedCount` | 收藏数 |
| `artistName` | `creator.nickname` | 创建者昵称 |
| `userId` | `creator.userId` | 创建者ID |
| `tags` | `tags` | 标签，如["欧美", "流行"] |
| `isHighQuality` | `highQuality` | 精品歌单标识 |

#### 数字专辑字段映射

| 属性名 | JSON 路径 | 说明 |
|--------|----------|------|
| `albumName` | `albumName` | 专辑名称 |
| `albumId` | `albumId` | 专辑ID |
| `artistName` | `artistName` | 艺术家名称 |
| `coverUrl` | `coverUrl` | 封面URL |
| `price` | `price` | 售价（元）|
| `saleNum` | `saleNum` | 已售数量 |
| `pubTime` | `pubTime` | 发布时间（毫秒时间戳）|
| `isNewAlbum` | `newAlbum` | 新专辑标记 |

---

## 三、数据结构关系图

```
XC_YYAlbumData (专辑/歌单)
    │
    ├── albumId: 专辑ID
    ├── albumName: 专辑名称
    ├── coverUrl: 专辑封面
    ├── artistName: 艺术家
    │
    └── 包含多首歌曲
            │
            ▼
    XC_YYSongData (歌曲)
            │
            ├── songId: 歌曲ID
            ├── name: 歌曲名
            ├── artist: 歌手名
            ├── mainIma: 封面图（继承专辑）
            ├── albumName: 专辑名
            ├── duration: 时长
            └── songUrl: 播放地址（需单独获取）
```

---

## 四、优先级建议

### 歌曲数据（必须实现）

| 优先级 | 字段 | 用途 |
|--------|------|------|
| P0 | `name` / `songId` | 基础标识 |
| P0 | `artist` | 播放器显示歌手名 |
| P0 | `mainIma` | 显示专辑封面 |
| P0 | `duration` | 播放器进度条、显示时长 |
| P1 | `albumName` | 播放器显示专辑名 |
| P1 | `mvId` | 判断是否有MV |
| P2 | `artists` | 多歌手场景 |
| P2 | `alias` | 显示歌曲副标题 |
| P2 | `popularity` | 热度排序 |

### 专辑数据（必须实现）

| 优先级 | 字段 | 用途 |
|--------|------|------|
| P0 | `name` / `albumId` | 基础标识 |
| P0 | `coverImageUrl` / `coverUrl` | 显示封面 |
| P0 | `artistName` | 显示创建者/艺术家 |
| P1 | `trackCount` | 显示歌曲数量 |
| P1 | `playCount` | 显示热度 |
| P2 | `tags` | 分类筛选 |
| P2 | `description` | 详情页展示 |

---

## 五、YYModel 配置示例

### XC-YYSongData.m

```objc
@implementation XC_YYSongData

+ (NSDictionary *)modelCustomPropertyMapper {
    return @{
        @"songId": @"id",
        @"mainIma": @"al.picUrl",
        @"albumName": @"al.name",
        @"albumId": @"al.id",
        @"duration": @"dt",
        @"trackNumber": @"no",
        @"mvId": @"mv",
        @"popularity": @"pop",
        @"alias": @"alia",
        @"fee": @"fee"
    };
}

- (BOOL)modelCustomTransformFromDictionary:(NSDictionary *)dic {
    // 处理 artists 数组
    NSArray *ar = dic[@"ar"];
    if (ar && ar.count > 0) {
        self.artists = ar;
        self.artist = ar[0][@"name"];
        self.artistId = [NSString stringWithFormat:@"%@", ar[0][@"id"]];
    }
    return YES;
}

- (NSString *)durationText {
    NSInteger seconds = self.duration / 1000;
    NSInteger min = seconds / 60;
    NSInteger sec = seconds % 60;
    return [NSString stringWithFormat:@"%02ld:%02ld", (long)min, (long)sec];
}

@end
```

### XC-YYAlbumData.m（歌单）

```objc
@implementation XC_YYAlbumData

+ (NSDictionary *)modelCustomPropertyMapper {
    return @{
        @"albumId": @"id",
        @"coverImageUrl": @"coverImgUrl",
        @"trackCount": @"trackCount",
        @"playCount": @"playCount",
        @"subscribeCount": @"subscribedCount",
        @"isHighQuality": @"highQuality",
        @"isOrdered": @"ordered"
    };
}

- (BOOL)modelCustomTransformFromDictionary:(NSDictionary *)dic {
    // 处理 creator 嵌套对象
    NSDictionary *creator = dic[@"creator"];
    if (creator) {
        self.artistName = creator[@"nickname"];
        self.userId = [NSString stringWithFormat:@"%@", creator[@"userId"]];
        self.creatorAvatarUrl = creator[@"avatarUrl"];
    }
    return YES;
}

@end
```

### XC-YYAlbumData.m（数字专辑）

```objc
@implementation XC_YYAlbumData (Product)

+ (NSDictionary *)modelCustomPropertyMapper {
    return @{
        @"albumId": @"albumId",
        @"albumName": @"albumName",
        @"artistName": @"artistName",
        @"coverUrl": @"coverUrl",
        @"price": @"price",
        @"saleNum": @"saleNum",
        @"pubTime": @"pubTime",
        @"isNewAlbum": @"newAlbum",
        @"albumType": @"albumType",
        @"area": @"area"
    };
}

@end
```
